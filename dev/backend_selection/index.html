<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Backend Selection · Margins.jl</title><meta name="title" content="Backend Selection · Margins.jl"/><meta property="og:title" content="Backend Selection · Margins.jl"/><meta property="twitter:title" content="Backend Selection · Margins.jl"/><meta name="description" content="Documentation for Margins.jl."/><meta property="og:description" content="Documentation for Margins.jl."/><meta property="twitter:description" content="Documentation for Margins.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Margins.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../mathematical_foundation/">Mathematical Foundation</a></li><li><a class="tocitem" href="../computational_architecture/">Computational Architecture</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../reference_grids/">Reference Grids</a></li><li><a class="tocitem" href="../profile_margins/">Profile Analysis</a></li><li><a class="tocitem" href="../grouping/">Population Grouping</a></li><li class="is-active"><a class="tocitem" href>Backend Selection</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Quick-Decision-Tree"><span>Quick Decision Tree</span></a></li><li><a class="tocitem" href="#Critical-Reliability-Differences"><span>Critical Reliability Differences</span></a></li><li><a class="tocitem" href="#Performance-Characteristics"><span>Performance Characteristics</span></a></li><li><a class="tocitem" href="#Numerical-Accuracy"><span>Numerical Accuracy</span></a></li><li><a class="tocitem" href="#Production-Recommendations"><span>Production Recommendations</span></a></li><li><a class="tocitem" href="#Troubleshooting-Backend-Issues"><span>Troubleshooting Backend Issues</span></a></li><li><a class="tocitem" href="#Advanced-Topics"><span>Advanced Topics</span></a></li><li><a class="tocitem" href="#Summary-Guidelines"><span>Summary Guidelines</span></a></li></ul></li><li><a class="tocitem" href="../performance/">Performance Guide</a></li><li><a class="tocitem" href="../advanced/">Advanced Features</a></li></ul></li><li><a class="tocitem" href="../stata_migration/">Migration Guide</a></li><li><a class="tocitem" href="../comparison/">Package Comparison</a></li><li><a class="tocitem" href="../api/">API Reference</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Backend Selection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Backend Selection</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl/" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Backend-Selection-Guide"><a class="docs-heading-anchor" href="#Backend-Selection-Guide">Backend Selection Guide</a><a id="Backend-Selection-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Selection-Guide" title="Permalink"></a></h1><p><em>Choosing between AD and FD backends for optimal reliability and performance</em></p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Margins.jl offers two computational backends for derivative calculation, each optimized for different use cases:</p><ul><li><strong><code>:ad</code></strong> (Automatic Differentiation) - Zero allocation, higher reliability, handles domain-sensitive functions</li><li><strong><code>:fd</code></strong> (Finite Differences) - Zero allocation, efficient for simple formulas</li></ul><p><strong>N.B.</strong>: For the most part, Finite Differences essentially has legacy status at this point, developed before efficient AD was implemented. The AD backend now provides superior performance, reliability, and maintains zero allocation.</p><p><strong>Summary</strong>: Use <strong><code>:ad</code></strong> for most applications. Zero allocation with comprehensive type support and robust domain handling.</p><h2 id="Quick-Decision-Tree"><a class="docs-heading-anchor" href="#Quick-Decision-Tree">Quick Decision Tree</a><a id="Quick-Decision-Tree-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Decision-Tree" title="Permalink"></a></h2><pre><code class="nohighlight hljs">For most applications:
└── Use backend=:ad (recommended default)
    ├── Zero allocation performance
    ├── Machine precision accuracy
    ├── All numeric types supported
    └── Robust domain handling

Use backend=:fd for:
├── Specific compatibility requirements
└── Simple linear formulas</code></pre><p>The AD backend supports all integer types (Int8, Int16, UInt32, etc.) with zero allocation performance.</p><h2 id="Critical-Reliability-Differences"><a class="docs-heading-anchor" href="#Critical-Reliability-Differences">Critical Reliability Differences</a><a id="Critical-Reliability-Differences-1"></a><a class="docs-heading-anchor-permalink" href="#Critical-Reliability-Differences" title="Permalink"></a></h2><h3 id="**Domain-Sensitive-Functions:-Always-Use-AD**"><a class="docs-heading-anchor" href="#**Domain-Sensitive-Functions:-Always-Use-AD**"><strong>Domain-Sensitive Functions: Always Use AD</strong></a><a id="**Domain-Sensitive-Functions:-Always-Use-AD**-1"></a><a class="docs-heading-anchor-permalink" href="#**Domain-Sensitive-Functions:-Always-Use-AD**" title="Permalink"></a></h3><p><strong>Functions that require <code>backend=:ad</code>:</strong></p><pre><code class="language-julia hljs"># Log transformations - FD can push values below zero
model = lm(@formula(y ~ log(x)), data)
population_margins(model, data; backend=:ad)  # Required

# Square root functions - FD can push values negative  
model = lm(@formula(y ~ sqrt(x)), data)  
population_margins(model, data; backend=:ad)  # Required

# Inverse functions near zero - FD can create division issues
model = lm(@formula(y ~ 1/x), data)
population_margins(model, data; backend=:ad)  # Recommended

# Fractional powers - Similar domain sensitivity as sqrt
model = lm(@formula(y ~ x^(1/3)), data)
population_margins(model, data; backend=:ad)  # Recommended</code></pre><p><strong>Why FD fails</strong>: Finite difference computation <code>f(x+h) - f(x)</code> can push arguments outside valid domains:</p><ul><li><code>log(x+h)</code> where <code>x+h &lt; 0</code> → <code>DomainError</code>  </li><li><code>sqrt(x+h)</code> where <code>x+h &lt; 0</code> → <code>DomainError</code></li><li><code>1/(x+h)</code> where <code>x+h ≈ 0</code> → numerical instability</li></ul><p><strong>Why AD succeeds</strong>: Automatic differentiation computes exact derivatives without domain-violating function evaluations.</p><h3 id="**Functions-Safe-for-Either-Backend**"><a class="docs-heading-anchor" href="#**Functions-Safe-for-Either-Backend**"><strong>Functions Safe for Either Backend</strong></a><a id="**Functions-Safe-for-Either-Backend**-1"></a><a class="docs-heading-anchor-permalink" href="#**Functions-Safe-for-Either-Backend**" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Linear relationships - both backends equivalent
model = lm(@formula(y ~ x + z), data)  
population_margins(model, data; backend=:fd)   # Efficient performance
population_margins(model, data; backend=:ad)   # Equivalent results

# Polynomial functions - both work well
model = lm(@formula(y ~ x + x^2), data)
population_margins(model, data; backend=:fd)   # Choose based on performance needs
population_margins(model, data; backend=:ad)   # Same statistical results

# Simple transformations - no domain issues
model = lm(@formula(y ~ x/10 + z*2), data)
population_margins(model, data; backend=:fd)   # Zero allocation</code></pre><h2 id="Performance-Characteristics"><a class="docs-heading-anchor" href="#Performance-Characteristics">Performance Characteristics</a><a id="Performance-Characteristics-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Characteristics" title="Permalink"></a></h2><h3 id="Memory-Usage-Analysis"><a class="docs-heading-anchor" href="#Memory-Usage-Analysis">Memory Usage Analysis</a><a id="Memory-Usage-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Usage-Analysis" title="Permalink"></a></h3><p><strong>Both backends now achieve zero allocation performance:</strong></p><pre><code class="language-julia hljs"># FD: Zero allocation after warmup
@allocated population_margins(model, data_100; backend=:fd)    # 0 bytes
@allocated population_margins(model, data_1000; backend=:fd)   # 0 bytes  
@allocated population_margins(model, data_5000; backend=:fd)   # 0 bytes

# AD: Zero allocation after warmup
@allocated population_margins(model, data_100; backend=:ad)    # 0 bytes
@allocated population_margins(model, data_1000; backend=:ad)   # 0 bytes
@allocated population_margins(model, data_5000; backend=:ad)   # 0 bytes</code></pre><p><strong>Memory Usage Decision:</strong></p><ul><li><strong>All dataset sizes</strong>: Both backends achieve zero allocation performance</li><li><strong>Choice based on reliability and accuracy</strong>: AD provides superior domain handling</li><li><strong>Construction cost</strong>: AD requires slightly more memory during evaluator setup (amortized over many evaluations)</li></ul><h3 id="Speed-Performance"><a class="docs-heading-anchor" href="#Speed-Performance">Speed Performance</a><a id="Speed-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Speed-Performance" title="Permalink"></a></h3><p>Both backends achieve excellent performance, with AD providing 3-5x improvements:</p><pre><code class="language-julia hljs"># Typical performance ranges (varies by system and model complexity)
# Small problems (n=100-1000)  
@btime population_margins($model, $data; backend=:fd)  # 0.1-10ms (baseline)
@btime population_margins($model, $data; backend=:ad)  # 0.05-5ms (3-5x faster!)

# Large problems (n=10000+)
@btime population_margins($model, $large_data; backend=:fd)  # Scales linearly with n
@btime population_margins($model, $large_data; backend=:ad)  # Scales linearly, but with better constant factors</code></pre><p><strong>Key insight</strong>: With zero-allocation AD, the performance differences now favor AD in most cases, while maintaining superior numerical properties.</p><h2 id="Numerical-Accuracy"><a class="docs-heading-anchor" href="#Numerical-Accuracy">Numerical Accuracy</a><a id="Numerical-Accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-Accuracy" title="Permalink"></a></h2><h3 id="Both-Backends-Provide-Equivalent-Accuracy"><a class="docs-heading-anchor" href="#Both-Backends-Provide-Equivalent-Accuracy">Both Backends Provide Equivalent Accuracy</a><a id="Both-Backends-Provide-Equivalent-Accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Both-Backends-Provide-Equivalent-Accuracy" title="Permalink"></a></h3><p>For well-conditioned problems, both backends produce statistically equivalent results:</p><pre><code class="language-julia hljs"># Linear models - identical to machine precision
fd_result = population_margins(model, data; backend=:fd)
ad_result = population_margins(model, data; backend=:ad)

DataFrame(fd_result).estimate ≈ DataFrame(ad_result).estimate  # rtol=1e-12 PASS

# GLM models - equivalent within appropriate tolerances  
fd_glm = population_margins(glm_model, data; backend=:fd)
ad_glm = population_margins(glm_model, data; backend=:ad)

DataFrame(fd_glm).estimate ≈ DataFrame(ad_glm).estimate  # rtol=1e-10 PASS</code></pre><h3 id="AD-May-Be-More-Accurate-For"><a class="docs-heading-anchor" href="#AD-May-Be-More-Accurate-For">AD May Be More Accurate For</a><a id="AD-May-Be-More-Accurate-For-1"></a><a class="docs-heading-anchor-permalink" href="#AD-May-Be-More-Accurate-For" title="Permalink"></a></h3><ul><li>Complex function compositions</li><li>Functions with steep gradients  </li><li>Near-boundary evaluations</li><li>Models with numerical conditioning issues</li></ul><h2 id="Production-Recommendations"><a class="docs-heading-anchor" href="#Production-Recommendations">Production Recommendations</a><a id="Production-Recommendations-1"></a><a class="docs-heading-anchor-permalink" href="#Production-Recommendations" title="Permalink"></a></h2><h3 id="Backend-Selection-Policy"><a class="docs-heading-anchor" href="#Backend-Selection-Policy">Backend Selection Policy</a><a id="Backend-Selection-Policy-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Selection-Policy" title="Permalink"></a></h3><ul><li>No <code>:auto</code> mode is provided.</li><li>No implicit backend fallbacks are performed.</li><li>Select <code>backend</code> explicitly. Use <code>:ad</code> by default; use <code>:fd</code> only when explicitly intended and theoretically safe.</li></ul><h3 id="Backend-Selection-by-Use-Case"><a class="docs-heading-anchor" href="#Backend-Selection-by-Use-Case">Backend Selection by Use Case</a><a id="Backend-Selection-by-Use-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Selection-by-Use-Case" title="Permalink"></a></h3><table><tr><th style="text-align: right"><strong>Use Case</strong></th><th style="text-align: right"><strong>Backend</strong></th><th style="text-align: right"><strong>Rationale</strong></th></tr><tr><td style="text-align: right"><strong>Domain-sensitive functions</strong></td><td style="text-align: right"><code>:ad</code></td><td style="text-align: right">Required for log(), sqrt(), 1/x</td></tr><tr><td style="text-align: right"><strong>General production workflows</strong></td><td style="text-align: right"><code>:ad</code></td><td style="text-align: right">Zero allocation + higher reliability + faster</td></tr><tr><td style="text-align: right"><strong>Large datasets (&gt;10k)</strong></td><td style="text-align: right"><code>:ad</code></td><td style="text-align: right">Zero allocation + superior performance</td></tr><tr><td style="text-align: right"><strong>Memory-constrained systems</strong></td><td style="text-align: right">Either</td><td style="text-align: right">Both achieve zero allocation</td></tr><tr><td style="text-align: right"><strong>Development/testing</strong></td><td style="text-align: right"><code>:ad</code></td><td style="text-align: right">Higher reliability, now zero allocation</td></tr><tr><td style="text-align: right"><strong>High-precision requirements</strong></td><td style="text-align: right"><code>:ad</code></td><td style="text-align: right">Machine precision + zero allocation</td></tr><tr><td style="text-align: right"><strong>Simple linear formulas</strong></td><td style="text-align: right"><code>:fd</code></td><td style="text-align: right">May be slightly faster for basic operations</td></tr></table><h3 id="Production-Configuration-Guidance"><a class="docs-heading-anchor" href="#Production-Configuration-Guidance">Production Configuration Guidance</a><a id="Production-Configuration-Guidance-1"></a><a class="docs-heading-anchor-permalink" href="#Production-Configuration-Guidance" title="Permalink"></a></h3><ul><li>Default to <code>backend=:ad</code> for reliability and accuracy (also zero allocation).</li><li>Use <code>backend=:fd</code> only for simple, well-conditioned formulas and when you explicitly want FD.</li><li>For domain-sensitive functions (log, sqrt, 1/x near 0), always use <code>:ad</code>.</li></ul><h2 id="Troubleshooting-Backend-Issues"><a class="docs-heading-anchor" href="#Troubleshooting-Backend-Issues">Troubleshooting Backend Issues</a><a id="Troubleshooting-Backend-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting-Backend-Issues" title="Permalink"></a></h2><h3 id="Common-Error-Patterns"><a class="docs-heading-anchor" href="#Common-Error-Patterns">Common Error Patterns</a><a id="Common-Error-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Error-Patterns" title="Permalink"></a></h3><h4 id="DomainError-with-FD-Backend"><a class="docs-heading-anchor" href="#DomainError-with-FD-Backend">DomainError with FD Backend</a><a id="DomainError-with-FD-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#DomainError-with-FD-Backend" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Error: DomainError with -1.23e-6: log was called with a negative real number
result = population_margins(model, data; backend=:fd)  #  Fails

# Solution: Use AD backend for log functions
result = population_margins(model, data; backend=:ad)  # Works</code></pre><h4 id="Memory-Pressure-with-AD-Backend"><a class="docs-heading-anchor" href="#Memory-Pressure-with-AD-Backend">Memory Pressure with AD Backend</a><a id="Memory-Pressure-with-AD-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Pressure-with-AD-Backend" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Large dataset causing memory issues with AD
huge_result = population_margins(model, huge_data; backend=:ad)  # May run out of memory

# Solution: Use FD backend for memory efficiency
huge_result = population_margins(model, huge_data; backend=:fd)  # Constant memory</code></pre><h3 id="Backend-Validation-Testing"><a class="docs-heading-anchor" href="#Backend-Validation-Testing">Backend Validation Testing</a><a id="Backend-Validation-Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-Validation-Testing" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Test both backends for new functions
function test_backend_compatibility(model, data)
    try_fd = try population_margins(model, data; backend=:fd) catch nothing end
    try_ad = try population_margins(model, data; backend=:ad) catch nothing end
    
    if try_fd === nothing &amp;&amp; try_ad !== nothing
        @warn &quot;Function requires AD backend - FD fails with domain error&quot;
        return :ad_required
    elseif try_fd !== nothing &amp;&amp; try_ad !== nothing
        # Compare results for consistency
        fd_est = DataFrame(try_fd).estimate
        ad_est = DataFrame(try_ad).estimate
        
        if fd_est ≈ ad_est rtol=1e-10
            @info &quot;Both backends produce consistent results&quot;
            return :either_ok
        else
            @warn &quot;Backends produce different results - investigate numerical issues&quot;
            return :inconsistent
        end
    else
        @error &quot;Both backends failed&quot;
        return :both_failed
    end
end

# Usage
compatibility = test_backend_compatibility(model, data)</code></pre><h2 id="Advanced-Topics"><a class="docs-heading-anchor" href="#Advanced-Topics">Advanced Topics</a><a id="Advanced-Topics-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Topics" title="Permalink"></a></h2><h3 id="FormulaCompiler-Integration"><a class="docs-heading-anchor" href="#FormulaCompiler-Integration">FormulaCompiler Integration</a><a id="FormulaCompiler-Integration-1"></a><a class="docs-heading-anchor-permalink" href="#FormulaCompiler-Integration" title="Permalink"></a></h3><p>Both backends leverage FormulaCompiler.jl&#39;s optimized evaluation:</p><pre><code class="language-julia hljs"># FD: Uses finite difference approximation with compiled evaluators
# - Zero allocation after warmup
# - Reuses pre-allocated buffers
# - Scalar operations avoid broadcast allocations

# AD: Uses dual number arithmetic with compiled evaluators (OPTIMIZED)
# - Zero allocation after warmup via pre-conversion strategy
# - Exact derivative computation with machine precision
# - 3-5x performance improvement over previous AD implementation
# - Composition via chain rule with type homogeneity</code></pre><h3 id="Custom-Tolerance-Settings"><a class="docs-heading-anchor" href="#Custom-Tolerance-Settings">Custom Tolerance Settings</a><a id="Custom-Tolerance-Settings-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Tolerance-Settings" title="Permalink"></a></h3><p>For functions near domain boundaries, you may need custom tolerances:</p><pre><code class="language-julia hljs"># Custom finite difference step size (advanced)
# Note: This is a FormulaCompiler.jl setting, not directly exposed in Margins.jl
# Contact maintainers if you need custom FD step sizes for specific functions</code></pre><h2 id="Summary-Guidelines"><a class="docs-heading-anchor" href="#Summary-Guidelines">Summary Guidelines</a><a id="Summary-Guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-Guidelines" title="Permalink"></a></h2><h3 id="**Default-Strategy-(Recommended):**"><a class="docs-heading-anchor" href="#**Default-Strategy-(Recommended):**"><strong>Default Strategy (Recommended):</strong></a><a id="**Default-Strategy-(Recommended):**-1"></a><a class="docs-heading-anchor-permalink" href="#**Default-Strategy-(Recommended):**" title="Permalink"></a></h3><ol><li><p><strong>For domain-sensitive functions (log, sqrt, 1/x):</strong></p><ul><li><strong>Always use AD</strong> (<code>:ad</code>) - FD will fail with DomainErrors</li></ul></li><li><p><strong>For all other functions:</strong></p><ul><li><strong>Use AD as default</strong> (<code>:ad</code>) - Zero allocation + faster + more reliable</li><li><strong>Use FD only for:</strong> Simple linear formulas where marginal speed differences matter</li></ul></li><li><p><strong>When in doubt:</strong> Use <code>:ad</code> - it now provides the best of all worlds (zero allocation, speed, reliability)</p></li></ol><h3 id="**Statistical-Guarantees:**"><a class="docs-heading-anchor" href="#**Statistical-Guarantees:**"><strong>Statistical Guarantees:</strong></a><a id="**Statistical-Guarantees:**-1"></a><a class="docs-heading-anchor-permalink" href="#**Statistical-Guarantees:**" title="Permalink"></a></h3><p>Both backends maintain statistical correctness when they succeed:</p><ul><li>Same delta-method standard errors (when computed successfully)</li><li>Same marginal effect estimates (when numerically stable)  </li><li>Same confidence intervals and hypothesis tests</li></ul><p><strong>The reliability difference is in computational robustness, not statistical validity.</strong></p><hr/><p><em>For performance optimization details, see <a href="../performance/">Performance Guide</a>. For mathematical background, see <a href="../mathematical_foundation/">Mathematical Foundation</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../grouping/">« Population Grouping</a><a class="docs-footer-nextpage" href="../performance/">Performance Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Saturday 13 September 2025 01:52">Saturday 13 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
