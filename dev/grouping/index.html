<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Population Grouping · Margins.jl</title><meta name="title" content="Population Grouping · Margins.jl"/><meta property="og:title" content="Population Grouping · Margins.jl"/><meta property="twitter:title" content="Population Grouping · Margins.jl"/><meta name="description" content="Documentation for Margins.jl."/><meta property="og:description" content="Documentation for Margins.jl."/><meta property="twitter:description" content="Documentation for Margins.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Margins.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Margins.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../mathematical_foundation/">Mathematical Foundation</a></li><li><a class="tocitem" href="../computational_architecture/">Computational Architecture</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../reference_grids/">Reference Grids</a></li><li><a class="tocitem" href="../profile_margins/">Profile Analysis</a></li><li><a class="tocitem" href="../population_scenarios/">Population Scenarios</a></li><li><a class="tocitem" href="../second_differences/">Second Differences</a></li><li><a class="tocitem" href="../weights/">Weights</a></li><li class="is-active"><a class="tocitem" href>Population Grouping</a><ul class="internal"><li><a class="tocitem" href="#Conceptual-Foundation"><span>Conceptual Foundation</span></a></li><li><a class="tocitem" href="#Basic-Grouping-Patterns"><span>Basic Grouping Patterns</span></a></li><li><a class="tocitem" href="#Advanced-Hierarchical-Grouping"><span>Advanced Hierarchical Grouping</span></a></li><li><a class="tocitem" href="#Continuous-Variable-Binning"><span>Continuous Variable Binning</span></a></li><li><a class="tocitem" href="#Counterfactual-Scenario-Analysis"><span>Counterfactual Scenario Analysis</span></a></li><li><a class="tocitem" href="#Combined-Groups-and-Scenarios"><span>Combined Groups and Scenarios</span></a></li><li><a class="tocitem" href="#Important:-Skip-Rule-for-Statistical-Validity"><span>Important: Skip Rule for Statistical Validity</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Best-Practices"><span>Best Practices</span></a></li></ul></li><li><a class="tocitem" href="../backend_selection/">Backend Selection</a></li><li><a class="tocitem" href="../performance/">Performance Guide</a></li><li><a class="tocitem" href="../advanced/">Advanced Features</a></li></ul></li><li><a class="tocitem" href="../stata_migration/">Migration Guide</a></li><li><a class="tocitem" href="../comparison/">Package Comparison</a></li><li><a class="tocitem" href="../api/">API Reference</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Population Grouping</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Population Grouping</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl/" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Population-Grouping-Framework"><a class="docs-heading-anchor" href="#Population-Grouping-Framework">Population Grouping Framework</a><a id="Population-Grouping-Framework-1"></a><a class="docs-heading-anchor-permalink" href="#Population-Grouping-Framework" title="Permalink"></a></h1><p><em>Comprehensive hierarchical analysis for stratified marginal effects</em></p><h2 id="Conceptual-Foundation"><a class="docs-heading-anchor" href="#Conceptual-Foundation">Conceptual Foundation</a><a id="Conceptual-Foundation-1"></a><a class="docs-heading-anchor-permalink" href="#Conceptual-Foundation" title="Permalink"></a></h2><p>Margins.jl implements a population-based grouping framework that computes <strong>average marginal effects (AME)</strong> and <strong>average adjusted predictions (AAP)</strong> within stratified subgroups of the observed data.</p><h3 id="Core-Design-Principles"><a class="docs-heading-anchor" href="#Core-Design-Principles">Core Design Principles</a><a id="Core-Design-Principles-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Design-Principles" title="Permalink"></a></h3><h4 id="Population-Based-Analysis"><a class="docs-heading-anchor" href="#Population-Based-Analysis">Population-Based Analysis</a><a id="Population-Based-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Population-Based-Analysis" title="Permalink"></a></h4><p>All operations maintain population averaging semantics - computing effects by averaging across actual or modified populations, not evaluating at synthetic representative points.</p><h4 id="Orthogonal-Parameters"><a class="docs-heading-anchor" href="#Orthogonal-Parameters">Orthogonal Parameters</a><a id="Orthogonal-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Orthogonal-Parameters" title="Permalink"></a></h4><p>Three independent dimensions combine multiplicatively:</p><ul><li><strong><code>vars</code></strong>: Which variables to compute marginal effects for</li><li><strong><code>groups</code></strong>: How to stratify the analysis (data structure) </li><li><strong><code>scenarios</code></strong>: What counterfactual scenarios to consider (data modification)</li></ul><h4 id="Single-Fundamental-Operation"><a class="docs-heading-anchor" href="#Single-Fundamental-Operation">Single Fundamental Operation</a><a id="Single-Fundamental-Operation-1"></a><a class="docs-heading-anchor-permalink" href="#Single-Fundamental-Operation" title="Permalink"></a></h4><p>All grouping reduces to: <strong>stratify data into subgroups, compute population margins within each subgroup</strong>.</p><h2 id="Basic-Grouping-Patterns"><a class="docs-heading-anchor" href="#Basic-Grouping-Patterns">Basic Grouping Patterns</a><a id="Basic-Grouping-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Grouping-Patterns" title="Permalink"></a></h2><h3 id="Simple-Categorical-Grouping"><a class="docs-heading-anchor" href="#Simple-Categorical-Grouping">Simple Categorical Grouping</a><a id="Simple-Categorical-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-Categorical-Grouping" title="Permalink"></a></h3><p>Compute effects separately within each category of a grouping variable:</p><pre><code class="language-julia hljs">using Margins, DataFrames, GLM

# Effects by education level
education_effects = population_margins(model, data; 
                                     type=:effects, 
                                     groups=:education)

# Results: separate effects for each education category
DataFrame(education_effects)</code></pre><h3 id="Cross-Tabulated-Grouping"><a class="docs-heading-anchor" href="#Cross-Tabulated-Grouping">Cross-Tabulated Grouping</a><a id="Cross-Tabulated-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Cross-Tabulated-Grouping" title="Permalink"></a></h3><p>Analyze effects across combinations of multiple categorical variables:</p><pre><code class="language-julia hljs"># Effects by education × gender combinations
demographic_effects = population_margins(model, data;
                                        type=:effects,
                                        groups=[:education, :gender])

# Results: effects for (HS,Male), (HS,Female), (College,Male), (College,Female), etc.</code></pre><h2 id="Advanced-Hierarchical-Grouping"><a class="docs-heading-anchor" href="#Advanced-Hierarchical-Grouping">Advanced Hierarchical Grouping</a><a id="Advanced-Hierarchical-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Hierarchical-Grouping" title="Permalink"></a></h2><h3 id="Nested-Grouping-with-Operator"><a class="docs-heading-anchor" href="#Nested-Grouping-with-Operator">Nested Grouping with <code>=&gt;</code> Operator</a><a id="Nested-Grouping-with-Operator-1"></a><a class="docs-heading-anchor-permalink" href="#Nested-Grouping-with-Operator" title="Permalink"></a></h3><p>The <code>=&gt;</code> operator creates hierarchical nesting where the right side is computed within each level of the left side:</p><pre><code class="language-julia hljs"># Region first, then education within each region
nested_effects = population_margins(model, data;
                                  type=:effects,
                                  groups=:region =&gt; :education)

# Results: (North,HS), (North,College), (South,HS), (South,College)</code></pre><h3 id="Deep-Hierarchical-Nesting"><a class="docs-heading-anchor" href="#Deep-Hierarchical-Nesting">Deep Hierarchical Nesting</a><a id="Deep-Hierarchical-Nesting-1"></a><a class="docs-heading-anchor-permalink" href="#Deep-Hierarchical-Nesting" title="Permalink"></a></h3><p>Multiple levels of nesting support complex organizational structures:</p><pre><code class="language-julia hljs"># Three-level hierarchy: country → region → education
deep_hierarchy = population_margins(model, data;
                                  type=:effects,
                                  groups=:country =&gt; (:region =&gt; :education))

# Four-level hierarchy: sector → company → department → position
organizational = population_margins(model, data;
                                  type=:effects, 
                                  groups=:sector =&gt; (:company =&gt; (:department =&gt; :position)))</code></pre><h3 id="Parallel-Grouping-Within-Hierarchy"><a class="docs-heading-anchor" href="#Parallel-Grouping-Within-Hierarchy">Parallel Grouping Within Hierarchy</a><a id="Parallel-Grouping-Within-Hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-Grouping-Within-Hierarchy" title="Permalink"></a></h3><p>Complex patterns combining hierarchical and cross-tabulated structures:</p><pre><code class="language-julia hljs"># Region first, then education×gender cross-tab within each region
parallel_nested = population_margins(model, data;
                                   type=:effects,
                                   groups=:region = [:education, :gender])

# Region first, then separate analyses for education levels AND income quartiles
mixed_parallel = population_margins(model, data;
                                  type=:effects,
                                  groups=:region = [:education, (:income, 4)])</code></pre><h2 id="Continuous-Variable-Binning"><a class="docs-heading-anchor" href="#Continuous-Variable-Binning">Continuous Variable Binning</a><a id="Continuous-Variable-Binning-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-Variable-Binning" title="Permalink"></a></h2><h3 id="Quantile-Based-Binning"><a class="docs-heading-anchor" href="#Quantile-Based-Binning">Quantile-Based Binning</a><a id="Quantile-Based-Binning-1"></a><a class="docs-heading-anchor-permalink" href="#Quantile-Based-Binning" title="Permalink"></a></h3><p>Automatic binning using quantiles with professional statistical terminology:</p><pre><code class="language-julia hljs"># Quartile analysis (Q1, Q2, Q3, Q4)
income_quartiles = population_margins(model, data;
                                    type=:effects,
                                    groups=(:income, 4))

# Tertile analysis (T1, T2, T3) 
score_tertiles = population_margins(model, data;
                                  type=:effects,
                                  groups=(:test_score, 3))

# Quintile analysis (P1, P2, P3, P4, P5)
wealth_quintiles = population_margins(model, data;
                                    type=:effects,
                                    groups=(:wealth, 5))</code></pre><h3 id="Custom-Threshold-Binning"><a class="docs-heading-anchor" href="#Custom-Threshold-Binning">Custom Threshold Binning</a><a id="Custom-Threshold-Binning-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Threshold-Binning" title="Permalink"></a></h3><p>Policy-relevant thresholds using mathematical interval notation:</p><pre><code class="language-julia hljs"># Income brackets for tax policy analysis
tax_brackets = population_margins(model, data;
                                type=:effects,
                                groups=(:income, [25000, 50000, 75000]))

# Results: [&quot;&lt; 25000&quot;, &quot;[25000, 50000)&quot;, &quot;[50000, 75000)&quot;, &quot;&gt;= 75000&quot;]

# Poverty line analysis
poverty_analysis = population_margins(model, data;
                                    type=:effects,
                                    groups=(:income, [federal_poverty_line]))

# Results: [&quot;&lt; 12880&quot;, &quot;&gt;= 12880&quot;] (using 2023 federal poverty guideline)</code></pre><h3 id="Mixed-Categorical-and-Continuous-Grouping"><a class="docs-heading-anchor" href="#Mixed-Categorical-and-Continuous-Grouping">Mixed Categorical and Continuous Grouping</a><a id="Mixed-Categorical-and-Continuous-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-Categorical-and-Continuous-Grouping" title="Permalink"></a></h3><p>Combine categorical variables with binned continuous variables:</p><pre><code class="language-julia hljs"># Education levels × income quartiles
education_income = population_margins(model, data;
                                    type=:effects,
                                    groups=[:education, (:income, 4)])

# Results: (HS,Q1), (HS,Q2), (HS,Q3), (HS,Q4), (College,Q1), etc.

# Geographic region × age quintiles × gender
complex_demographics = population_margins(model, data;
                                        type=:effects,
                                        groups=[:region, (:age, 5), :gender])</code></pre><h2 id="Counterfactual-Scenario-Analysis"><a class="docs-heading-anchor" href="#Counterfactual-Scenario-Analysis">Counterfactual Scenario Analysis</a><a id="Counterfactual-Scenario-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Counterfactual-Scenario-Analysis" title="Permalink"></a></h2><p>See <a href="../population_scenarios/">Population Scenarios</a> for detailed semantics and implementation notes on scenarios in population analysis.</p><h3 id="Policy-Scenario-Framework"><a class="docs-heading-anchor" href="#Policy-Scenario-Framework">Policy Scenario Framework</a><a id="Policy-Scenario-Framework-1"></a><a class="docs-heading-anchor-permalink" href="#Policy-Scenario-Framework" title="Permalink"></a></h3><p>The <code>scenarios</code> parameter modifies variable values for the entire population, creating counterfactual analyses:</p><pre><code class="language-julia hljs"># Binary treatment analysis
treatment_effects = population_margins(model, data;
                                     type=:effects,
                                     scenarios=(:treatment = [0, 1]))

# Multi-level policy scenarios
policy_scenarios = population_margins(model, data;
                                    type=:effects,
                                    scenarios=(:policy_level = [&quot;none&quot;, &quot;moderate&quot;, &quot;aggressive&quot;]))</code></pre><h3 id="Multi-Variable-Scenarios"><a class="docs-heading-anchor" href="#Multi-Variable-Scenarios">Multi-Variable Scenarios</a><a id="Multi-Variable-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Variable-Scenarios" title="Permalink"></a></h3><p>Cartesian product expansion for complex policy analysis:</p><pre><code class="language-julia hljs"># Treatment × policy combinations
comprehensive_policy = population_margins(model, data;
                                        type=:effects,
                                        scenarios=(:treatment = [0, 1], 
                                                      :policy = [&quot;current&quot;, &quot;reform&quot;]))

# Results: 4 scenarios (2×2 combinations)

# Three-dimensional policy space
complex_scenarios = population_margins(model, data;
                                     type=:effects,
                                     scenarios=(:treatment = [0, 1],
                                                   :funding = [0.8, 1.0, 1.2],
                                                   :regulation = [&quot;light&quot;, &quot;standard&quot;, &quot;strict&quot;]))

# Results: 18 scenarios (2×3×3 combinations)</code></pre><h2 id="Combined-Groups-and-Scenarios"><a class="docs-heading-anchor" href="#Combined-Groups-and-Scenarios">Combined Groups and Scenarios</a><a id="Combined-Groups-and-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Combined-Groups-and-Scenarios" title="Permalink"></a></h2><h3 id="Comprehensive-Policy-Analysis"><a class="docs-heading-anchor" href="#Comprehensive-Policy-Analysis">Comprehensive Policy Analysis</a><a id="Comprehensive-Policy-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Comprehensive-Policy-Analysis" title="Permalink"></a></h3><p>Groups and scenarios combine multiplicatively for complete analytical coverage:</p><pre><code class="language-julia hljs"># Demographics × policy scenarios
full_analysis = population_margins(model, data;
                                 type=:effects,
                                 groups=[:education, :region],
                                 scenarios=(:treatment = [0, 1]))

# Results: Each education×region combination under both treatment scenarios</code></pre><h3 id="Advanced-Applications"><a class="docs-heading-anchor" href="#Advanced-Applications">Advanced Applications</a><a id="Advanced-Applications-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Applications" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Healthcare policy evaluation
healthcare_comprehensive = population_margins(health_model, health_data;
    type=:effects,
    groups=:state = (:urban_rural = [:insurance_type, (:income, 3)]),
    scenarios=(:aca_expansion = [0, 1], :medicaid_funding = [0.8, 1.2])
)

# Results: State × Urban/Rural × (Insurance×Income-Tertiles) × ACA×Medicaid scenarios
# Total combinations: 4 states × 2 urban/rural × 12 insurance×income × 4 policy scenarios = 384 results</code></pre><h2 id="Important:-Skip-Rule-for-Statistical-Validity"><a class="docs-heading-anchor" href="#Important:-Skip-Rule-for-Statistical-Validity">Important: Skip Rule for Statistical Validity</a><a id="Important:-Skip-Rule-for-Statistical-Validity-1"></a><a class="docs-heading-anchor-permalink" href="#Important:-Skip-Rule-for-Statistical-Validity" title="Permalink"></a></h2><p><strong>Critical Constraint:</strong> For population analysis, computing the effect of a variable while simultaneously holding it fixed (via <code>scenarios</code>) or using it to define subgroups (via <code>groups</code>) is contradictory and statistically meaningless.</p><h3 id="The-Skip-Rule"><a class="docs-heading-anchor" href="#The-Skip-Rule">The Skip Rule</a><a id="The-Skip-Rule-1"></a><a class="docs-heading-anchor-permalink" href="#The-Skip-Rule" title="Permalink"></a></h3><p>To preserve statistical correctness and interpretability, <code>population_margins()</code> <strong>automatically skips</strong> variables that appear in <code>vars</code> if they also appear in <code>groups</code> or <code>scenarios</code>.</p><pre><code class="language-julia hljs"># Example: x appears in both vars and scenarios
result = population_margins(model, data;
    type=:effects,
    vars=[:x, :z],           # Request effects for x and z
    scenarios=(:x = [0, 1])  # But fix x at specific values
)
# Result: Only z effect is computed. x is skipped because it&#39;s in scenarios.
# The package silently handles this to avoid statistical errors.</code></pre><h3 id="Why-This-Rule-Exists"><a class="docs-heading-anchor" href="#Why-This-Rule-Exists">Why This Rule Exists</a><a id="Why-This-Rule-Exists-1"></a><a class="docs-heading-anchor-permalink" href="#Why-This-Rule-Exists" title="Permalink"></a></h3><p><strong>Conceptual Problem:</strong></p><ul><li><strong>Marginal effect</strong> asks: &quot;What happens when x changes naturally?&quot;</li><li><strong>Scenario/Group</strong> says: &quot;Hold x fixed at specific values&quot; or &quot;Stratify by x levels&quot;</li><li>These two concepts are <strong>mutually exclusive</strong></li></ul><p><strong>Examples of Invalid Requests:</strong></p><pre><code class="language-julia hljs"># INVALID: &quot;What&#39;s the effect of income while holding income fixed?&quot;
population_margins(model, data;
    vars=[:income],            # Effect of income changing
    scenarios=(:income = [30000, 50000])  # But income is fixed
)
# → income is skipped from vars

# INVALID: &quot;What&#39;s the effect of education within education groups?&quot;
population_margins(model, data;
    vars=[:education],         # Effect of education changing
    groups=:education          # But stratified by education levels
)
# → education is skipped from vars</code></pre><h3 id="Practical-Alternatives"><a class="docs-heading-anchor" href="#Practical-Alternatives">Practical Alternatives</a><a id="Practical-Alternatives-1"></a><a class="docs-heading-anchor-permalink" href="#Practical-Alternatives" title="Permalink"></a></h3><h4 id="Alternative-1:-Profile-Analysis-(for-Stata-users)"><a class="docs-heading-anchor" href="#Alternative-1:-Profile-Analysis-(for-Stata-users)">Alternative 1: Profile Analysis (for Stata users)</a><a id="Alternative-1:-Profile-Analysis-(for-Stata-users)-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-1:-Profile-Analysis-(for-Stata-users)" title="Permalink"></a></h4><p>If you want Stata-style <code>dydx(x) over(x)</code> (derivative of x at different values of x), use <strong>profile analysis</strong>:</p><pre><code class="language-julia hljs"># Instead of: population_margins(model, data; vars=[:x], groups=:x)  # INVALID
# Use profile margins:
result = profile_margins(model, data, cartesian_grid(x=[10, 20, 30, 40]);
    type=:effects,
    vars=[:x]
)
# Computes marginal effect of x AT each specific value of x</code></pre><h4 id="Alternative-2:-Effects-Within-Strata"><a class="docs-heading-anchor" href="#Alternative-2:-Effects-Within-Strata">Alternative 2: Effects Within Strata</a><a id="Alternative-2:-Effects-Within-Strata-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-2:-Effects-Within-Strata" title="Permalink"></a></h4><p>If you want effects within strata of x, group by a <strong>different variable</strong> or compute effects of <strong>other variables</strong>:</p><pre><code class="language-julia hljs"># GOOD: Effects of z within education groups
result = population_margins(model, data;
    type=:effects,
    vars=[:z],              # Effect of z (not education)
    groups=:education       # Stratified by education
)

# GOOD: Effects within income quintiles
result = population_margins(model, data;
    type=:effects,
    vars=[:treatment],      # Effect of treatment (not income)
    groups=(:income, 5)     # Within income quintiles
)</code></pre><h4 id="Alternative-3:-Counterfactual-Predictions"><a class="docs-heading-anchor" href="#Alternative-3:-Counterfactual-Predictions">Alternative 3: Counterfactual Predictions</a><a id="Alternative-3:-Counterfactual-Predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-3:-Counterfactual-Predictions" title="Permalink"></a></h4><p>If you want to see how outcomes change as x varies, use <strong>predictions with scenarios</strong>:</p><pre><code class="language-julia hljs"># Instead of: population_margins(model, data; vars=[:x], scenarios=(:x = [...]))
# Use predictions:
result = population_margins(model, data;
    type=:predictions,         # Not effects!
    scenarios=(:x = [10, 20, 30, 40])
)
# Shows predicted outcomes at each value of x</code></pre><h3 id="User-Notification"><a class="docs-heading-anchor" href="#User-Notification">User Notification</a><a id="User-Notification-1"></a><a class="docs-heading-anchor-permalink" href="#User-Notification" title="Permalink"></a></h3><p><strong>Current Behavior:</strong> The skip rule operates <strong>silently</strong> - variables are removed from computation without warning.</p><p><strong>How to Check:</strong> Compare requested <code>vars</code> against result:</p><pre><code class="language-julia hljs">result = population_margins(model, data;
    vars=[:x, :z],
    scenarios=(:x = [0, 1])
)
df = DataFrame(result)
unique(df.variable)  # Will only show &quot;z&quot; (x was skipped)</code></pre><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><h3 id="Computational-Complexity"><a class="docs-heading-anchor" href="#Computational-Complexity">Computational Complexity</a><a id="Computational-Complexity-1"></a><a class="docs-heading-anchor-permalink" href="#Computational-Complexity" title="Permalink"></a></h3><p>Population grouping maintains efficient O(n) scaling within each subgroup:</p><pre><code class="language-julia hljs">using BenchmarkTools

# Simple grouping: O(n/k) per group for k groups
@btime population_margins($model, $data; groups=:education)

# Complex hierarchical grouping: O(n/k) per final subgroup
@btime population_margins($model, $data; groups=:region = (:education = :gender))

# With scenarios: same O(n/k) complexity repeated for each scenario
@btime population_margins($model, $data; groups=:education, scenarios=(:treatment = [0, 1]))</code></pre><h3 id="Memory-Efficiency"><a class="docs-heading-anchor" href="#Memory-Efficiency">Memory Efficiency</a><a id="Memory-Efficiency-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Efficiency" title="Permalink"></a></h3><p>The grouping framework avoids data duplication through efficient indexing:</p><ul><li><strong>Subgroup filtering</strong>: Uses DataFrame indexing, not data copying</li><li><strong>Scenario modification</strong>: Temporary overrides without permanent data changes  </li><li><strong>Result aggregation</strong>: Minimal memory footprint for result compilation</li></ul><h3 id="Large-Dataset-Considerations"><a class="docs-heading-anchor" href="#Large-Dataset-Considerations">Large Dataset Considerations</a><a id="Large-Dataset-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Large-Dataset-Considerations" title="Permalink"></a></h3><pre><code class="language-julia hljs"># For datasets &gt;100k observations with many groups
# Consider selective analysis of key variables
key_analysis = population_margins(model, large_data;
                                type=:effects,
                                vars=[:primary_outcome],  # Limit variables
                                groups=(:income, 4))      # Manageable grouping

# Complex patterns still feasible for large n
complex_large = population_margins(model, large_data;
                                 type=:effects,
                                 groups=:region = [:education, (:income, 4)])</code></pre><h2 id="Best-Practices"><a class="docs-heading-anchor" href="#Best-Practices">Best Practices</a><a id="Best-Practices-1"></a><a class="docs-heading-anchor-permalink" href="#Best-Practices" title="Permalink"></a></h2><h3 id="When-to-Use-Different-Grouping-Patterns"><a class="docs-heading-anchor" href="#When-to-Use-Different-Grouping-Patterns">When to Use Different Grouping Patterns</a><a id="When-to-Use-Different-Grouping-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-Use-Different-Grouping-Patterns" title="Permalink"></a></h3><p><strong>Simple Grouping</strong> (<code>groups=:var</code>):</p><ul><li>Single dimension analysis</li><li>Clear categorical divisions</li><li>Straightforward interpretation needs</li></ul><p><strong>Cross-Tabulation</strong> (<code>groups=[:var1, :var2]</code>):</p><ul><li>Interaction effects important</li><li>Policy targets multiple demographics simultaneously</li><li>Comprehensive coverage needed</li></ul><p><strong>Hierarchical Grouping</strong> (<code>groups=:var1 =&gt; :var2</code>):</p><ul><li>Natural organizational structure exists</li><li>Context matters (e.g., regions have different education systems)</li><li>Nested decision-making processes</li></ul><p><strong>Continuous Binning</strong> (<code>groups=(:var, n)</code>):</p><ul><li>Policy-relevant thresholds exist</li><li>Distribution-based analysis needed</li><li>Quantile-based interpretation valuable</li></ul><h3 id="Avoiding-Common-Pitfalls"><a class="docs-heading-anchor" href="#Avoiding-Common-Pitfalls">Avoiding Common Pitfalls</a><a id="Avoiding-Common-Pitfalls-1"></a><a class="docs-heading-anchor-permalink" href="#Avoiding-Common-Pitfalls" title="Permalink"></a></h3><h4 id="Combination-Explosion"><a class="docs-heading-anchor" href="#Combination-Explosion">Combination Explosion</a><a id="Combination-Explosion-1"></a><a class="docs-heading-anchor-permalink" href="#Combination-Explosion" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Dangerous: could create 1000s of combinations
# groups=[:var1, :var2, :var3, (:var4, 10), (:var5, 5)]

# Better: use hierarchical structure
groups=:var1 =&gt; [:var2, (:var4, 4)]</code></pre><h4 id="Empty-Subgroups"><a class="docs-heading-anchor" href="#Empty-Subgroups">Empty Subgroups</a><a id="Empty-Subgroups-1"></a><a class="docs-heading-anchor-permalink" href="#Empty-Subgroups" title="Permalink"></a></h4><pre><code class="language-julia hljs"># The framework automatically detects and errors on empty subgroups
# to maintain statistical validity</code></pre><h4 id="Skip-Rule-Reference"><a class="docs-heading-anchor" href="#Skip-Rule-Reference">Skip Rule Reference</a><a id="Skip-Rule-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Skip-Rule-Reference" title="Permalink"></a></h4><p>See the dedicated section <strong>&quot;Important: Skip Rule for Statistical Validity&quot;</strong> above for complete documentation on how <code>population_margins()</code> handles variables that appear in both <code>vars</code> and <code>groups</code>/<code>scenarios</code>.</p><h4 id="Interpretation-Complexity"><a class="docs-heading-anchor" href="#Interpretation-Complexity">Interpretation Complexity</a><a id="Interpretation-Complexity-1"></a><a class="docs-heading-anchor-permalink" href="#Interpretation-Complexity" title="Permalink"></a></h4><pre><code class="language-julia hljs"># For presentation, consider simpler patterns:
presentation_analysis = population_margins(model, data;
                                         groups=:education,
                                         scenarios=(:policy = [0, 1]))

# For comprehensive analysis, use full complexity:
research_analysis = population_margins(model, data;
                                     groups=:region = [:education, (:income, 4)],
                                     scenarios=(:policy = [0, 1], :funding = [0.8, 1.2]))</code></pre><hr/><p><em>The population grouping framework enables sophisticated econometric analysis while maintaining computational efficiency and statistical rigor. For related details on scenarios and reference grids, see <a href="../reference_grids/">Reference Grids</a> and for performance optimization, see <a href="../performance/">Performance Guide</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../weights/">« Weights</a><a class="docs-footer-nextpage" href="../backend_selection/">Backend Selection »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Thursday 13 November 2025 14:30">Thursday 13 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
