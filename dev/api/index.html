<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · Margins.jl</title><meta name="title" content="API Reference · Margins.jl"/><meta property="og:title" content="API Reference · Margins.jl"/><meta property="twitter:title" content="API Reference · Margins.jl"/><meta name="description" content="Documentation for Margins.jl."/><meta property="og:description" content="Documentation for Margins.jl."/><meta property="twitter:description" content="Documentation for Margins.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Margins.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../mathematical_foundation/">Mathematical Foundation</a></li><li><a class="tocitem" href="../computational_architecture/">Computational Architecture</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../reference_grids/">Reference Grids</a></li><li><a class="tocitem" href="../profile_margins/">Profile Analysis</a></li><li><a class="tocitem" href="../population_scenarios/">Population Scenarios</a></li><li><a class="tocitem" href="../weights/">Weights</a></li><li><a class="tocitem" href="../grouping/">Population Grouping</a></li><li><a class="tocitem" href="../backend_selection/">Backend Selection</a></li><li><a class="tocitem" href="../performance/">Performance Guide</a></li><li><a class="tocitem" href="../advanced/">Advanced Features</a></li></ul></li><li><a class="tocitem" href="../stata_migration/">Migration Guide</a></li><li><a class="tocitem" href="../comparison/">Package Comparison</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Conceptual-Foundation"><span>Conceptual Foundation</span></a></li><li><a class="tocitem" href="#Function-Specifications"><span>Function Specifications</span></a></li><li><a class="tocitem" href="#Result-Type-Specifications"><span>Result Type Specifications</span></a></li><li><a class="tocitem" href="#Extended-Analytical-Capabilities"><span>Extended Analytical Capabilities</span></a></li><li><a class="tocitem" href="#Parameter-Reference"><span>Parameter Reference</span></a></li><li><a class="tocitem" href="#Usage-Patterns"><span>Usage Patterns</span></a></li><li><a class="tocitem" href="#Error-Handling"><span>Error Handling</span></a></li><li><a class="tocitem" href="#Integration-Examples"><span>Integration Examples</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl/" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><p><em>Comprehensive technical specification for Margins.jl functions and types</em></p><h2 id="Conceptual-Foundation"><a class="docs-heading-anchor" href="#Conceptual-Foundation">Conceptual Foundation</a><a id="Conceptual-Foundation-1"></a><a class="docs-heading-anchor-permalink" href="#Conceptual-Foundation" title="Permalink"></a></h2><h3 id="Two-Function-Architecture"><a class="docs-heading-anchor" href="#Two-Function-Architecture">Two-Function Architecture</a><a id="Two-Function-Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Two-Function-Architecture" title="Permalink"></a></h3><p>The package implements a systematic two-function API that operationalizes the unified analytical framework through distinct computational pathways for population-level and profile-specific marginal effects analysis.</p><h3 id="Analysis-Type-Distinction"><a class="docs-heading-anchor" href="#Analysis-Type-Distinction">Analysis Type Distinction</a><a id="Analysis-Type-Distinction-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-Type-Distinction" title="Permalink"></a></h3><ul><li><strong>Population Analysis</strong>: Integration over empirical covariate distributions</li><li><strong>Profile Analysis</strong>: Evaluation at specified covariate combinations</li></ul><h2 id="Function-Specifications"><a class="docs-heading-anchor" href="#Function-Specifications">Function Specifications</a><a id="Function-Specifications-1"></a><a class="docs-heading-anchor-permalink" href="#Function-Specifications" title="Permalink"></a></h2><h3 id="Population-Analysis"><a class="docs-heading-anchor" href="#Population-Analysis">Population Analysis</a><a id="Population-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Population-Analysis" title="Permalink"></a></h3><h3 id="population_margins"><a class="docs-heading-anchor" href="#population_margins"><code>population_margins</code></a><a id="population_margins-1"></a><a class="docs-heading-anchor-permalink" href="#population_margins" title="Permalink"></a></h3><p>Computes population-level marginal effects or adjusted predictions through integration over the empirical distribution of observed covariates.</p><p>The function implements population-averaged inference by computing marginal quantities for each observation in the sample and subsequently averaging these quantities according to the empirical distribution. This approach yields population parameters that reflect the heterogeneity present in the data generating process while providing appropriate standard errors through delta-method computation with full covariance matrix integration.</p><p><strong>Methodological Applications:</strong> Population analysis provides unbiased estimates of population parameters suitable for policy evaluation requiring external validity to similar populations. The approach proves particularly valuable when sample heterogeneity represents important features of the underlying population, and when analytical applications affect diverse demographic or economic groups requiring representative inference.</p><p><strong>Computational Characteristics</strong>: Linear scaling with respect to sample size while maintaining minimal per-observation computational overhead through optimized implementations. <em>Detailed performance analysis and computational complexity comparisons are provided in the <a href="../performance/">Performance Guide</a></em></p><p>See also: <a href="../population_scenarios/">Population Scenarios</a> for counterfactual analysis and <a href="../weights/">Weights</a> for sampling/frequency weights.</p><h3 id="Profile-Analysis"><a class="docs-heading-anchor" href="#Profile-Analysis">Profile Analysis</a><a id="Profile-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Analysis" title="Permalink"></a></h3><h3 id="profile_margins"><a class="docs-heading-anchor" href="#profile_margins"><code>profile_margins</code></a><a id="profile_margins-1"></a><a class="docs-heading-anchor-permalink" href="#profile_margins" title="Permalink"></a></h3><p>Computes marginal effects or adjusted predictions evaluated at specified covariate combinations within the covariate space.</p><p>The function implements profile-specific inference through evaluation of marginal quantities at predetermined points in the covariate space, typically at sample means or theoretically motivated scenario specifications. This approach yields concrete, interpretable estimates for specific covariate combinations while maintaining appropriate uncertainty quantification through delta-method standard error computation.</p><p><strong>Methodological Applications:</strong>   Profile analysis provides representative case inference suitable for policy targeting specific demographic or economic profiles. The approach facilitates clear communication of quantitative results through concrete scenario interpretation, making it particularly valuable for stakeholder communication and policy applications requiring specific target group analysis.</p><p><strong>Computational Characteristics</strong>: Constant-time complexity independent of dataset size through optimized evaluation algorithms that avoid full dataset traversal. <em>Comprehensive performance benchmarking and memory allocation analysis are detailed in the <a href="../performance/">Performance Guide</a></em></p><h2 id="Result-Type-Specifications"><a class="docs-heading-anchor" href="#Result-Type-Specifications">Result Type Specifications</a><a id="Result-Type-Specifications-1"></a><a class="docs-heading-anchor-permalink" href="#Result-Type-Specifications" title="Permalink"></a></h2><h3 id="Type-Safe-Result-System-(v2.0)"><a class="docs-heading-anchor" href="#Type-Safe-Result-System-(v2.0)">Type-Safe Result System (v2.0)</a><a id="Type-Safe-Result-System-(v2.0)-1"></a><a class="docs-heading-anchor-permalink" href="#Type-Safe-Result-System-(v2.0)" title="Permalink"></a></h3><p>Margins.jl implements a specialized type system that provides type safety and optimized DataFrame formatting through distinct result containers for different analysis types.</p><h3 id="EffectsResult"><a class="docs-heading-anchor" href="#EffectsResult"><code>EffectsResult</code></a><a id="EffectsResult-1"></a><a class="docs-heading-anchor-permalink" href="#EffectsResult" title="Permalink"></a></h3><p>Structured container for marginal effects analysis (AME, MEM, MER) implementing the Tables.jl interface protocol.</p><p>The <code>EffectsResult</code> type encapsulates computed marginal effects along with associated statistical inference quantities including standard errors, confidence intervals, and hypothesis test statistics. The type contains variable identification fields (<code>variables</code>, <code>terms</code>) essential for effects interpretation and supports multiple DataFrame formatting options.</p><p><strong>Key Features:</strong></p><ul><li>Contains <code>variables</code> field (the &quot;x&quot; in dy/dx identification)  </li><li>Contains <code>terms</code> field (contrast descriptions like &quot;derivative&quot;, &quot;treated vs control&quot;)</li><li>Multiple DataFrame formats: <code>:standard</code>, <code>:compact</code>, <code>:confidence</code>, <code>:profile</code>, <code>:stata</code></li><li>Auto-detects appropriate format based on analysis type</li></ul><h3 id="PredictionsResult"><a class="docs-heading-anchor" href="#PredictionsResult"><code>PredictionsResult</code></a><a id="PredictionsResult-1"></a><a class="docs-heading-anchor-permalink" href="#PredictionsResult" title="Permalink"></a></h3><p>Streamlined container for predictions analysis (AAP, APM, APR) implementing the Tables.jl interface protocol.</p><p>The <code>PredictionsResult</code> type focuses specifically on predicted values without variable/contrast concepts, providing a clean interface optimized for predictions analysis. The streamlined design reflects that predictions represent &quot;fitted values at scenarios&quot; rather than &quot;effects of variables.&quot;</p><p><strong>Key Features:</strong></p><ul><li>Omits variable/contrast fields (not applicable to predictions)</li><li>Single optimized DataFrame format for predictions display  </li><li>Clean tabular output focused on prediction values and statistics</li></ul><p><strong>Data Integration Framework:</strong></p><pre><code class="language-julia hljs"># Type-specific result containers with Tables.jl protocol
effects_result = population_margins(model, data; type=:effects)  # Returns EffectsResult
predictions_result = population_margins(model, data; type=:predictions)  # Returns PredictionsResult

# Type-specific DataFrame conversion
effects_df = DataFrame(effects_result)  # Includes variable/contrast columns
predictions_df = DataFrame(predictions_result)  # Streamlined predictions format

# Multiple format options for effects
DataFrame(effects_result; format=:compact)  # Minimal columns
DataFrame(effects_result; format=:stata)    # Stata-style column names

# Compatible with all Tables.jl-compliant output formats  
CSV.write(&quot;effects.csv&quot;, effects_result)
CSV.write(&quot;predictions.csv&quot;, predictions_result)</code></pre><h2 id="Extended-Analytical-Capabilities"><a class="docs-heading-anchor" href="#Extended-Analytical-Capabilities">Extended Analytical Capabilities</a><a id="Extended-Analytical-Capabilities-1"></a><a class="docs-heading-anchor-permalink" href="#Extended-Analytical-Capabilities" title="Permalink"></a></h2><h3 id="Categorical-Mixture-Specifications"><a class="docs-heading-anchor" href="#Categorical-Mixture-Specifications">Categorical Mixture Specifications</a><a id="Categorical-Mixture-Specifications-1"></a><a class="docs-heading-anchor-permalink" href="#Categorical-Mixture-Specifications" title="Permalink"></a></h3><p>The package implements sophisticated categorical mixture functionality to enable realistic policy scenario analysis through fractional category specifications. The <code>CategoricalMixture</code> type facilitates the specification of probability-weighted categorical distributions that reflect realistic population compositions rather than arbitrary baseline categories.</p><p><strong>Policy Counterfactual Analysis:</strong></p><pre><code class="language-julia hljs"># Current population educational composition (predictions at a mixture)
baseline_grid = DataFrame(education=[mix(&quot;HS&quot; =&gt; 0.4, &quot;College&quot; =&gt; 0.4, &quot;Graduate&quot; =&gt; 0.2)])
baseline = profile_margins(model, data, baseline_grid; type=:predictions)

# Policy counterfactual: educational attainment improvement (new mixture)
intervention_grid = DataFrame(education=[mix(&quot;HS&quot; =&gt; 0.2, &quot;College&quot; =&gt; 0.5, &quot;Graduate&quot; =&gt; 0.3)])
intervention = profile_margins(model, data, intervention_grid; type=:predictions)</code></pre><h2 id="Parameter-Reference"><a class="docs-heading-anchor" href="#Parameter-Reference">Parameter Reference</a><a id="Parameter-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-Reference" title="Permalink"></a></h2><h3 id="Common-Parameters"><a class="docs-heading-anchor" href="#Common-Parameters">Common Parameters</a><a id="Common-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Parameters" title="Permalink"></a></h3><p><strong>Quick Start Examples</strong>:</p><ul><li><code>type=:effects</code> → &quot;How much does the outcome change?&quot; (most common)  </li><li><code>type=:predictions</code> → &quot;What outcome value should I expect?&quot;</li><li><code>measure=:elasticity</code> → &quot;What&#39;s the percentage effect?&quot; (useful for proportional changes)</li><li><code>backend=:ad</code> → Use default (most accurate, zero allocation)</li><li><code>backend=:fd</code> → Alternative backend (legacy compatibility)</li></ul><p>All main functions support these core parameters:</p><h4 id="Analysis-Type-(type)"><a class="docs-heading-anchor" href="#Analysis-Type-(type)">Analysis Type (<code>type</code>)</a><a id="Analysis-Type-(type)-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-Type-(type)" title="Permalink"></a></h4><ul><li><code>:effects</code> - Marginal effects (derivatives for continuous, contrasts for categorical)</li><li><code>:predictions</code> - Adjusted predictions (fitted values)</li></ul><h4 id="Variable-Selection-(vars)"><a class="docs-heading-anchor" href="#Variable-Selection-(vars)">Variable Selection (<code>vars</code>)</a><a id="Variable-Selection-(vars)-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Selection-(vars)" title="Permalink"></a></h4><ul><li><code>nothing</code> - Auto-detect continuous variables (default for effects)</li><li><code>:all_continuous</code> - Explicit selection of all continuous variables</li><li><code>:variable_name</code> - Single variable</li><li><code>[:var1, :var2]</code> - Multiple specific variables</li></ul><h4 id="Target-Scale-(scale)"><a class="docs-heading-anchor" href="#Target-Scale-(scale)">Target Scale (<code>scale</code>)</a><a id="Target-Scale-(scale)-1"></a><a class="docs-heading-anchor-permalink" href="#Target-Scale-(scale)" title="Permalink"></a></h4><ul><li><code>:response</code> - Response scale (default, applies inverse link function)</li><li><code>:link</code> - Linear predictor scale (link scale)</li></ul><h4 id="Computational-Backend-(backend)"><a class="docs-heading-anchor" href="#Computational-Backend-(backend)">Computational Backend (<code>backend</code>)</a><a id="Computational-Backend-(backend)-1"></a><a class="docs-heading-anchor-permalink" href="#Computational-Backend-(backend)" title="Permalink"></a></h4><ul><li><code>:ad</code> - Automatic differentiation (default; higher accuracy, zero allocation after warmup)</li><li><code>:fd</code> - Finite differences (zero allocation, production-ready)</li></ul><h4 id="Effect-Measures-(measure)"><a class="docs-heading-anchor" href="#Effect-Measures-(measure)">Effect Measures (<code>measure</code>)</a><a id="Effect-Measures-(measure)-1"></a><a class="docs-heading-anchor-permalink" href="#Effect-Measures-(measure)" title="Permalink"></a></h4><ul><li><code>:effect</code> - Standard marginal effects (default)</li><li><code>:elasticity</code> - Elasticities (% change in Y per % change in X)</li><li><code>:semielasticity_dyex</code> - Semielasticity d(y)/d(ln x) (change in Y per % change in X)</li><li><code>:semielasticity_eydx</code> - Semielasticity d(ln y)/dx (% change in Y per unit change in X)</li></ul><h3 id="Profile-Specific-Parameters"><a class="docs-heading-anchor" href="#Profile-Specific-Parameters">Profile-Specific Parameters</a><a id="Profile-Specific-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Specific-Parameters" title="Permalink"></a></h3><h4 id="Profile-Specification-(at)"><a class="docs-heading-anchor" href="#Profile-Specification-(at)">Profile Specification (<code>at</code>)</a><a id="Profile-Specification-(at)-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Specification-(at)" title="Permalink"></a></h4><ul><li><code>:means</code> - Effects/predictions at sample means</li><li><code>Dict(:var =&gt; [val1, val2])</code> - Cartesian product specification</li><li><code>[Dict(:var =&gt; val1), Dict(:var =&gt; val2)]</code> - Explicit profile list</li><li><code>DataFrame</code> - Pre-built reference grid (maximum control)</li></ul><p><strong>Examples:</strong></p><pre><code class="language-julia hljs"># At sample means (most common)
profile_margins(model, data, means_grid(data))

# Cartesian product: 6 scenarios (3×2)
profile_margins(model, data, cartesian_grid(x=[0,1,2], group=[&quot;A&quot;,&quot;B&quot;]))

# Hierarchical grid construction using group grammar
reference_spec = :region =&gt; [(:income, :quartiles), (:age, :mean)]
profile_margins(model, data, hierarchical_grid(data, reference_spec))

# Deep hierarchical nesting for complex policy analysis
policy_spec = :country =&gt; (:region =&gt; (:education =&gt; [(:income, :quintiles), (:age, :mean)]))
profile_margins(model, data, hierarchical_grid(data, policy_spec; max_depth=4))

# DataFrame grid (full control)
grid = DataFrame(x=[0,1,2], group=[&quot;A&quot;,&quot;A&quot;,&quot;B&quot;])
profile_margins(model, data, grid)</code></pre><h3 id="Population-Specific-Parameters"><a class="docs-heading-anchor" href="#Population-Specific-Parameters">Population-Specific Parameters</a><a id="Population-Specific-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Population-Specific-Parameters" title="Permalink"></a></h3><h4 id="Grouping-(over)"><a class="docs-heading-anchor" href="#Grouping-(over)">Grouping (<code>over</code>)</a><a id="Grouping-(over)-1"></a><a class="docs-heading-anchor-permalink" href="#Grouping-(over)" title="Permalink"></a></h4><ul><li><code>Symbol</code> - Single grouping variable</li><li><code>Vector{Symbol}</code> - Multiple grouping variables  </li><li><code>NamedTuple</code> - Advanced grouping with value specifications</li></ul><p><strong>Examples:</strong></p><pre><code class="language-julia hljs"># By single categorical variable
population_margins(model, data; groups=:region)

# Multiple grouping
population_margins(model, data; groups=[:region, :year])

# Advanced grouping (unified syntax)
population_margins(model, data; groups=(:income, [20000, 50000, 80000]))</code></pre><h4 id="Counterfactual-Analysis-(scenarios)"><a class="docs-heading-anchor" href="#Counterfactual-Analysis-(scenarios)">Counterfactual Analysis (<code>scenarios</code>)</a><a id="Counterfactual-Analysis-(scenarios)-1"></a><a class="docs-heading-anchor-permalink" href="#Counterfactual-Analysis-(scenarios)" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Effects when treatment is set to 1 vs 0 for entire population
population_margins(model, data; scenarios=(treatment=[0, 1]), type=:effects)</code></pre><h2 id="Usage-Patterns"><a class="docs-heading-anchor" href="#Usage-Patterns">Usage Patterns</a><a id="Usage-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-Patterns" title="Permalink"></a></h2><h3 id="Basic-Workflow"><a class="docs-heading-anchor" href="#Basic-Workflow">Basic Workflow</a><a id="Basic-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Workflow" title="Permalink"></a></h3><pre><code class="language-julia hljs"># 1. Fit model
model = lm(@formula(y ~ x1 + x2 + group), data)

# 2. Population analysis (most common starting point)
ame = population_margins(model, data)
aap = population_margins(model, data; type=:predictions)

# 3. Profile analysis for specific scenarios
mem = profile_margins(model, data, means_grid(data))
scenarios = profile_margins(model, data, cartesian_grid(x1=[0,1,2]))

# 4. Convert to DataFrame for analysis
DataFrame(ame)</code></pre><h3 id="Performance-Optimization"><a class="docs-heading-anchor" href="#Performance-Optimization">Performance Optimization</a><a id="Performance-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Optimization" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Maximum performance configuration
fast_result = population_margins(model, data; backend=:fd, scale=:link)

# Profile analysis is O(1) - efficient regardless of data size
scenarios = (var1=[-2,-1,0,1,2], var2=[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;])  # 15 scenarios
scenarios = cartesian_grid(x1=[0,1,2])
profile_result = profile_margins(model, huge_data, scenarios)  # ~300μs regardless of data size</code></pre><h3 id="Advanced-Analysis-Patterns"><a class="docs-heading-anchor" href="#Advanced-Analysis-Patterns">Advanced Analysis Patterns</a><a id="Advanced-Analysis-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Analysis-Patterns" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Elasticity analysis across scenarios (profile)
scenarios = cartesian_grid(x1=[0, 1, 2])
elasticities = profile_margins(model, data, scenarios; 
    measure=:elasticity, vars=[:x2])

# Robust standard errors (with CovarianceMatrices.jl)
using CovarianceMatrices
robust_effects = population_margins(model, data; vcov=CovarianceMatrices.HC1)

# Complex categorical scenarios via reference grid
policy_grid = DataFrame(
    treatment=[mix(0 =&gt; 0.3, 1 =&gt; 0.7)],           # 70% treatment rate
    education=[mix(&quot;HS&quot; =&gt; 0.3, &quot;College&quot; =&gt; 0.7)] # Education composition
)
policy_scenario = profile_margins(model, data, policy_grid; type=:predictions)</code></pre><h2 id="Error-Handling"><a class="docs-heading-anchor" href="#Error-Handling">Error Handling</a><a id="Error-Handling-1"></a><a class="docs-heading-anchor-permalink" href="#Error-Handling" title="Permalink"></a></h2><h3 id="Common-Error-Patterns"><a class="docs-heading-anchor" href="#Common-Error-Patterns">Common Error Patterns</a><a id="Common-Error-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Error-Patterns" title="Permalink"></a></h3><h4 id="Variable-Specification-Errors"><a class="docs-heading-anchor" href="#Variable-Specification-Errors">Variable Specification Errors</a><a id="Variable-Specification-Errors-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Specification-Errors" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Error: Variable not found
population_margins(model, data; vars=[:nonexistent_var])
# → Clear error message with available variables

# Error: Wrong variable type for effects  
population_margins(model, data; vars=[:categorical_var], type=:effects)
# → Suggests using categorical contrasts or predictions</code></pre><h4 id="Profile-Specification-Errors"><a class="docs-heading-anchor" href="#Profile-Specification-Errors">Profile Specification Errors</a><a id="Profile-Specification-Errors-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Specification-Errors" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Error: Invalid reference grid argument (must be DataFrame or a grid builder output)
profile_margins(model, data, &quot;invalid&quot;)
# → Clear guidance on valid reference grid specifications

# Error: Reference grid missing model variables
incomplete_grid = DataFrame(x1=[0,1])  # Missing x2, group from model
profile_margins(model, data, incomplete_grid)
# → Error with list of missing variables</code></pre><h4 id="Statistical-Validity-Errors"><a class="docs-heading-anchor" href="#Statistical-Validity-Errors">Statistical Validity Errors</a><a id="Statistical-Validity-Errors-1"></a><a class="docs-heading-anchor-permalink" href="#Statistical-Validity-Errors" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Error: Insufficient data for robust estimation
tiny_data = data[1:5, :]
population_margins(model, tiny_data)
# → Warning about statistical reliability with small samples</code></pre><h3 id="Error-Recovery-Patterns"><a class="docs-heading-anchor" href="#Error-Recovery-Patterns">Error Recovery Patterns</a><a id="Error-Recovery-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Error-Recovery-Patterns" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Input validation
function validated_margins(model, data; vars=nothing, kwargs...)
    # Validate variable existence
    if vars !== nothing
        data_vars = names(data)
        missing_vars = setdiff(vars, Symbol.(data_vars))
        if !isempty(missing_vars)
            throw(ArgumentError(&quot;Variables not found in data: $missing_vars&quot;))
        end
    end
    
    return population_margins(model, data; vars=vars, kwargs...)
end</code></pre><h2 id="Integration-Examples"><a class="docs-heading-anchor" href="#Integration-Examples">Integration Examples</a><a id="Integration-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Integration-Examples" title="Permalink"></a></h2><h3 id="With-GLM.jl-Ecosystem"><a class="docs-heading-anchor" href="#With-GLM.jl-Ecosystem">With GLM.jl Ecosystem</a><a id="With-GLM.jl-Ecosystem-1"></a><a class="docs-heading-anchor-permalink" href="#With-GLM.jl-Ecosystem" title="Permalink"></a></h3><pre><code class="language-julia hljs">using GLM, CategoricalArrays

# Logistic regression
model = glm(@formula(outcome ~ x1 + x2 + group), data, Binomial(), LogitLink())

# Effects on probability scale
prob_effects = population_margins(model, data; scale=:response, type=:effects)

# Effects on log-odds scale  
logodds_effects = population_margins(model, data; scale=:link, type=:effects)</code></pre><h3 id="With-CovarianceMatrices.jl"><a class="docs-heading-anchor" href="#With-CovarianceMatrices.jl">With CovarianceMatrices.jl</a><a id="With-CovarianceMatrices.jl-1"></a><a class="docs-heading-anchor-permalink" href="#With-CovarianceMatrices.jl" title="Permalink"></a></h3><pre><code class="language-julia hljs">using CovarianceMatrices

# Apply different estimators via vcov parameter
ame_hc1 = population_margins(model, data; vcov=CovarianceMatrices.HC1)
ame_hc3 = population_margins(model, data; vcov=CovarianceMatrices.HC3)
ame_clustered = population_margins(model, data; vcov=CovarianceMatrices.Clustered(:cluster_var))
ame_hac = population_margins(model, data; vcov=CovarianceMatrices.HAC(kernel=:bartlett))</code></pre><h3 id="With-DataFrames-Ecosystem"><a class="docs-heading-anchor" href="#With-DataFrames-Ecosystem">With DataFrames Ecosystem</a><a id="With-DataFrames-Ecosystem-1"></a><a class="docs-heading-anchor-permalink" href="#With-DataFrames-Ecosystem" title="Permalink"></a></h3><pre><code class="language-julia hljs">using DataFrames, CSV, Chain

# Complete analysis pipeline
results_df = @chain begin
    population_margins(model, data; type=:effects)
    DataFrame(_)
    select(_, :term, :estimate, :se, :p_value)
    filter(row -&gt; row.p_value &lt; 0.05, _)  # Significant effects only
end

# Export results
CSV.write(&quot;significant_effects.csv&quot;, results_df)</code></pre><hr/><p><em>This API reference provides complete documentation for all Margins.jl functionality. For conceptual background on the 2×2 framework, see <a href="../mathematical_foundation/">Mathematical Foundation</a>. For performance optimization guidance, see <a href="../performance/">Performance Guide</a>. For advanced features including elasticities and robust inference, see <a href="../advanced/">Advanced Features</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../comparison/">« Package Comparison</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Saturday 13 September 2025 02:43">Saturday 13 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
