<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Categorical Mixtures and Manual Contrasts · Margins.jl</title><meta name="title" content="Categorical Mixtures and Manual Contrasts · Margins.jl"/><meta property="og:title" content="Categorical Mixtures and Manual Contrasts · Margins.jl"/><meta property="twitter:title" content="Categorical Mixtures and Manual Contrasts · Margins.jl"/><meta name="description" content="Documentation for Margins.jl."/><meta property="og:description" content="Documentation for Margins.jl."/><meta property="twitter:description" content="Documentation for Margins.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Margins.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Margins.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../mathematical_foundation/">Mathematical Foundation</a></li><li><a class="tocitem" href="../../computational_architecture/">Computational Architecture</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../../reference_grids/">Reference Grids</a></li><li><a class="tocitem" href="../../profile_margins/">Profile Analysis</a></li><li><a class="tocitem" href="../../population_scenarios/">Population Scenarios</a></li><li><a class="tocitem" href="../../second_differences/">Second Differences</a></li><li><a class="tocitem" href="../../weights/">Weights</a></li><li><a class="tocitem" href="../../grouping/">Population Grouping</a></li><li><a class="tocitem" href="../../backend_selection/">Backend Selection</a></li><li><a class="tocitem" href="../../performance/">Performance Guide</a></li><li><a class="tocitem" href="../../advanced/">Advanced Features</a></li></ul></li><li><a class="tocitem" href="../../stata_migration/">Migration Guide</a></li><li><a class="tocitem" href="../../comparison/">Package Comparison</a></li><li><a class="tocitem" href="../../api/">API Reference</a></li><li><a class="tocitem" href="../../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Categorical Mixtures and Manual Contrasts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Categorical Mixtures and Manual Contrasts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl/" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Categorical-Mixtures-and-Manual-Contrasts"><a class="docs-heading-anchor" href="#Categorical-Mixtures-and-Manual-Contrasts">Categorical Mixtures and Manual Contrasts</a><a id="Categorical-Mixtures-and-Manual-Contrasts-1"></a><a class="docs-heading-anchor-permalink" href="#Categorical-Mixtures-and-Manual-Contrasts" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>When using categorical mixtures in reference grids, the package follows a clear design principle:</p><p><strong>Mixtures represent population composition context, not discrete scenarios to contrast.</strong></p><p>This means categorical variables specified as mixtures (either explicit <code>CategoricalMixture</code> objects or implicit frequency-weighted values for Bool variables) are <strong>skipped for automatic contrast computation</strong> in <code>profile_margins()</code>.</p><h2 id="Why-This-Design?"><a class="docs-heading-anchor" href="#Why-This-Design?">Why This Design?</a><a id="Why-This-Design?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-This-Design?" title="Permalink"></a></h2><h3 id="Mixtures-are-Context,-Not-Contrast-Targets"><a class="docs-heading-anchor" href="#Mixtures-are-Context,-Not-Contrast-Targets">Mixtures are Context, Not Contrast Targets</a><a id="Mixtures-are-Context,-Not-Contrast-Targets-1"></a><a class="docs-heading-anchor-permalink" href="#Mixtures-are-Context,-Not-Contrast-Targets" title="Permalink"></a></h3><p>A mixture specification like:</p><pre><code class="language-julia hljs">education = mix(&quot;hs&quot; =&gt; 0.4, &quot;college&quot; =&gt; 0.6)</code></pre><p>Represents: &quot;40% high school educated, 60% college educated&quot; — a weighted average population context.</p><p>Computing contrasts like &quot;0.6 college-mixture - 0.4 hs-mixture&quot; is clearly meaningful. Contrasts require discrete levels: &quot;college - hs&quot; is natural, but mixtures are less clearly so.</p><h3 id="Bool-Variables-with-Fractional-Values"><a class="docs-heading-anchor" href="#Bool-Variables-with-Fractional-Values">Bool Variables with Fractional Values</a><a id="Bool-Variables-with-Fractional-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Bool-Variables-with-Fractional-Values" title="Permalink"></a></h3><p>Similarly, when Bool variables are filled with fractional values during grid completion (e.g., <code>0.796</code> representing 79.6% true rate), they are treated as mixture specifications and skipped for contrasts:</p><pre><code class="language-julia hljs"># Bool variable filled by grid completion
ref_grid = DataFrame(treatment = [false, true])
# other_bool_var gets filled with frequency (e.g., 0.65 for 65% true)
result = profile_margins(model, df, ref_grid; type=:effects)
# [ Info: Skipping contrasts for variable other_bool_var: specified as mixture...</code></pre><h2 id="Recommended-Workflow:-APMs-Manual-Contrasts"><a class="docs-heading-anchor" href="#Recommended-Workflow:-APMs-Manual-Contrasts">Recommended Workflow: APMs + Manual Contrasts</a><a id="Recommended-Workflow:-APMs-Manual-Contrasts-1"></a><a class="docs-heading-anchor-permalink" href="#Recommended-Workflow:-APMs-Manual-Contrasts" title="Permalink"></a></h2><p>For computing contrasts between predictions at specific profiles with mixture context, use this two-step workflow:</p><h3 id="Step-1:-Compute-Adjusted-Predictions-at-Profiles-(APMs)"><a class="docs-heading-anchor" href="#Step-1:-Compute-Adjusted-Predictions-at-Profiles-(APMs)">Step 1: Compute Adjusted Predictions at Profiles (APMs)</a><a id="Step-1:-Compute-Adjusted-Predictions-at-Profiles-(APMs)-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Compute-Adjusted-Predictions-at-Profiles-(APMs)" title="Permalink"></a></h3><p>Use <code>profile_margins()</code> with <code>type=:predictions</code> to get predictions at specific profile points, with categorical mixtures providing population-weighted context:</p><pre><code class="language-julia hljs">using Margins, GLM, DataFrames, Statistics

# Define profiles with mixture context
ref_grid = DataFrame(
    treatment = [false, true],
    age = [mean(df.age), mean(df.age)]
    # education will be filled with frequency-weighted mixture
)

# Get predictions at these profiles
result = profile_margins(model, df, ref_grid; type=:predictions)
result_df = DataFrame(result; include_gradients=true)</code></pre><p><strong>Key Point</strong>: Include <code>include_gradients=true</code> to enable proper delta-method standard errors for contrasts.</p><h3 id="Step-2:-Compute-Contrasts-Manually"><a class="docs-heading-anchor" href="#Step-2:-Compute-Contrasts-Manually">Step 2: Compute Contrasts Manually</a><a id="Step-2:-Compute-Contrasts-Manually-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-Compute-Contrasts-Manually" title="Permalink"></a></h3><p>Use the <code>contrast()</code> function to compute contrasts between specific rows:</p><pre><code class="language-julia hljs"># Contrast row 2 vs row 1 (treatment:true - treatment:false)
contrast_result = contrast(result_df, 2, 1, vcov(model))

println(&quot;Treatment effect: &quot;, contrast_result.contrast)
println(&quot;Standard error: &quot;, contrast_result.se)
println(&quot;p-value: &quot;, contrast_result.p_value)
println(&quot;95% CI: [&quot;, contrast_result.ci_lower, &quot;, &quot;, contrast_result.ci_upper, &quot;]&quot;)</code></pre><h3 id="Complete-Example"><a class="docs-heading-anchor" href="#Complete-Example">Complete Example</a><a id="Complete-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-Example" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Margins, GLM, DataFrames, StatsModels, CategoricalArrays, Statistics
using Random
Random.seed!(123)

# Generate data
n = 200
df = DataFrame(
    education = categorical(rand([&quot;hs&quot;, &quot;college&quot;, &quot;grad&quot;], n)),
    treatment = rand(Bool, n),
    age = rand(25:65, n),
    y = randn(n) .+ 0.5 .* df.treatment  # True treatment effect
)

# Fit model
model = lm(@formula(y ~ education + treatment + age), df)

# Step 1: Get predictions with education as population-weighted context
ref_grid = DataFrame(
    treatment = [false, true],
    age = [mean(df.age), mean(df.age)]
)

result = profile_margins(model, df, ref_grid; type=:predictions)
result_df = DataFrame(result; include_gradients=true)

# Step 2: Compute treatment contrast
treatment_effect = contrast(result_df, 2, 1, vcov(model))

println(&quot;Treatment Effect (at mean age, population-weighted education):&quot;)
println(&quot;  Estimate: &quot;, round(treatment_effect.contrast, digits=3))
println(&quot;  SE: &quot;, round(treatment_effect.se, digits=3))
println(&quot;  95% CI: [&quot;, round(treatment_effect.ci_lower, digits=3),
        &quot;, &quot;, round(treatment_effect.ci_upper, digits=3), &quot;]&quot;)</code></pre><h2 id="Alternative-Approaches"><a class="docs-heading-anchor" href="#Alternative-Approaches">Alternative Approaches</a><a id="Alternative-Approaches-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-Approaches" title="Permalink"></a></h2><h3 id="Option-1:-Population-Average-Contrasts-(AME)"><a class="docs-heading-anchor" href="#Option-1:-Population-Average-Contrasts-(AME)">Option 1: Population Average Contrasts (AME)</a><a id="Option-1:-Population-Average-Contrasts-(AME)-1"></a><a class="docs-heading-anchor-permalink" href="#Option-1:-Population-Average-Contrasts-(AME)" title="Permalink"></a></h3><p>If you want contrasts averaged over the entire observed sample distribution:</p><pre><code class="language-julia hljs"># Average marginal effects with contrasts
result = population_margins(model, df; type=:effects, contrasts=:pairwise)</code></pre><p>This computes contrasts averaged over <strong>all observations</strong> in your data, not at specific profile points.</p><h3 id="Option-2:-Discrete-Levels-in-Reference-Grid"><a class="docs-heading-anchor" href="#Option-2:-Discrete-Levels-in-Reference-Grid">Option 2: Discrete Levels in Reference Grid</a><a id="Option-2:-Discrete-Levels-in-Reference-Grid-1"></a><a class="docs-heading-anchor-permalink" href="#Option-2:-Discrete-Levels-in-Reference-Grid" title="Permalink"></a></h3><p>If you want automatic pairwise contrasts at specific profiles without mixtures:</p><pre><code class="language-julia hljs"># Specify discrete levels explicitly
ref_grid = DataFrame(
    treatment = [false, false, true, true],
    education = categorical([&quot;hs&quot;, &quot;college&quot;, &quot;hs&quot;, &quot;college&quot;]),
    age = [mean(df.age), mean(df.age), mean(df.age), mean(df.age)]
)

result = profile_margins(model, df, ref_grid; type=:effects, contrasts=:pairwise)</code></pre><p>This computes contrasts for categorical variables at each discrete profile point.</p><h3 id="Option-3:-Quantile-or-Balanced-Grids"><a class="docs-heading-anchor" href="#Option-3:-Quantile-or-Balanced-Grids">Option 3: Quantile or Balanced Grids</a><a id="Option-3:-Quantile-or-Balanced-Grids-1"></a><a class="docs-heading-anchor-permalink" href="#Option-3:-Quantile-or-Balanced-Grids" title="Permalink"></a></h3><p>For systematic exploration of categorical × continuous interactions:</p><pre><code class="language-julia hljs"># Balanced grid with all categorical levels
ref_grid = balanced_grid(df; education=:all, age=[25, 45, 65])
result = profile_margins(model, df, ref_grid; type=:predictions)

# Then manually contrast specific rows of interest</code></pre><h2 id="When-to-Use-Each-Approach"><a class="docs-heading-anchor" href="#When-to-Use-Each-Approach">When to Use Each Approach</a><a id="When-to-Use-Each-Approach-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-Use-Each-Approach" title="Permalink"></a></h2><table><tr><th style="text-align: right">Goal</th><th style="text-align: right">Recommended Method</th></tr><tr><td style="text-align: right">Contrasts at specific profiles with mixture context</td><td style="text-align: right">APM + <code>contrast()</code></td></tr><tr><td style="text-align: right">Population-average contrasts (AME)</td><td style="text-align: right"><code>population_margins()</code> with <code>type=:effects</code></td></tr><tr><td style="text-align: right">Automatic pairwise contrasts at discrete profiles</td><td style="text-align: right"><code>profile_margins()</code> with discrete levels, <code>contrasts=:pairwise</code></td></tr><tr><td style="text-align: right">Complex custom contrasts</td><td style="text-align: right">APM/MEM + <code>contrast()</code> for full control</td></tr></table><h2 id="Design-Rationale"><a class="docs-heading-anchor" href="#Design-Rationale">Design Rationale</a><a id="Design-Rationale-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Rationale" title="Permalink"></a></h2><p>This design follows statistical correctness principles:</p><ol><li><strong>Statistical Validity is Paramount</strong>: Prevents meaningless &quot;mixture vs mixture&quot; contrasts</li><li><strong>Error-First Policy</strong>: Skips invalid operations rather than approximating</li><li><strong>Transparency</strong>: Clear info messages guide users toward valid workflows</li><li><strong>Publication-Grade Standards</strong>: Manual <code>contrast()</code> uses proper delta-method with full covariance matrix</li></ol><p>The APM + manual <code>contrast()</code> workflow provides:</p><ul><li>✅ Full statistical validity (proper delta-method standard errors)</li><li>✅ Maximum flexibility (contrast any rows you want)</li><li>✅ Clear interpretability (contrasts between specific profile points)</li><li>✅ Population-weighted context (mixtures provide realistic backdrop)</li></ul><h2 id="See-Also"><a class="docs-heading-anchor" href="#See-Also">See Also</a><a id="See-Also-1"></a><a class="docs-heading-anchor-permalink" href="#See-Also" title="Permalink"></a></h2><ul><li><a href="../../api/">API Reference</a> - See <code>contrast()</code> function documentation</li><li><a href="../../reference_grids/">Reference Grid Guide</a></li><li><a href="../../profile_margins/">Profile Margins</a></li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Saturday 25 October 2025 18:36">Saturday 25 October 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
