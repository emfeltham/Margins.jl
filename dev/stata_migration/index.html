<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Migration Guide · Margins.jl</title><meta name="title" content="Migration Guide · Margins.jl"/><meta property="og:title" content="Migration Guide · Margins.jl"/><meta property="twitter:title" content="Migration Guide · Margins.jl"/><meta name="description" content="Documentation for Margins.jl."/><meta property="og:description" content="Documentation for Margins.jl."/><meta property="twitter:description" content="Documentation for Margins.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Margins.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Margins.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../mathematical_foundation/">Mathematical Foundation</a></li><li><a class="tocitem" href="../computational_architecture/">Computational Architecture</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../reference_grids/">Reference Grids</a></li><li><a class="tocitem" href="../profile_margins/">Profile Analysis</a></li><li><a class="tocitem" href="../population_scenarios/">Population Scenarios</a></li><li><a class="tocitem" href="../second_differences/">Second Differences</a></li><li><a class="tocitem" href="../weights/">Weights</a></li><li><a class="tocitem" href="../grouping/">Population Grouping</a></li><li><a class="tocitem" href="../backend_selection/">Backend Selection</a></li><li><a class="tocitem" href="../performance/">Performance Guide</a></li><li><a class="tocitem" href="../advanced/">Advanced Features</a></li></ul></li><li class="is-active"><a class="tocitem" href>Migration Guide</a><ul class="internal"><li><a class="tocitem" href="#Basic-Command-Translation"><span>Basic Command Translation</span></a></li><li><a class="tocitem" href="#Grouping-and-Stratification"><span>Grouping and Stratification</span></a></li><li><a class="tocitem" href="#Scenario-Analysis-(at()-Specification)"><span>Scenario Analysis (<code>at()</code> Specification)</span></a></li><li><a class="tocitem" href="#Combined-Grouping-and-Scenarios"><span>Combined Grouping and Scenarios</span></a></li><li><a class="tocitem" href="#Advanced-Patterns-Beyond-Stata"><span>Advanced Patterns Beyond Stata</span></a></li><li><a class="tocitem" href="#Complete-Workflow-Examples"><span>Complete Workflow Examples</span></a></li><li><a class="tocitem" href="#Performance-Comparisons"><span>Performance Comparisons</span></a></li><li><a class="tocitem" href="#Migration-Best-Practices"><span>Migration Best Practices</span></a></li></ul></li><li><a class="tocitem" href="../comparison/">Package Comparison</a></li><li><a class="tocitem" href="../api/">API Reference</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Migration Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Migration Guide</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/emfeltham/Margins.jl/" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stata-Migration-Guide"><a class="docs-heading-anchor" href="#Stata-Migration-Guide">Stata Migration Guide</a><a id="Stata-Migration-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Stata-Migration-Guide" title="Permalink"></a></h1><p><em>Complete translation reference for economists migrating from Stata&#39;s <code>margins</code> command</em></p><h2 id="Basic-Command-Translation"><a class="docs-heading-anchor" href="#Basic-Command-Translation">Basic Command Translation</a><a id="Basic-Command-Translation-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Command-Translation" title="Permalink"></a></h2><h3 id="Core-Margins-Commands"><a class="docs-heading-anchor" href="#Core-Margins-Commands">Core Margins Commands</a><a id="Core-Margins-Commands-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Margins-Commands" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Command</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins</code></td><td style="text-align: right"><code>population_margins(model, data; type=:predictions)</code></td><td style="text-align: right">Average adjusted predictions</td></tr><tr><td style="text-align: right"><code>margins, dydx(*)</code></td><td style="text-align: right"><code>population_margins(model, data; type=:effects)</code></td><td style="text-align: right">Average marginal effects (AME)</td></tr><tr><td style="text-align: right"><code>margins, at(means)</code></td><td style="text-align: right"><code>profile_margins(model, data, means_grid(data); type=:predictions)</code></td><td style="text-align: right">Predictions at sample means</td></tr><tr><td style="text-align: right"><code>margins, at(means) dydx(*)</code></td><td style="text-align: right"><code>profile_margins(model, data, means_grid(data); type=:effects)</code></td><td style="text-align: right">Marginal effects at means (MEM)</td></tr><tr><td style="text-align: right"><code>margins, dydx(*) atmeans</code></td><td style="text-align: right"><code>profile_margins(model, data, means_grid(data); type=:effects)</code></td><td style="text-align: right">Alternative MEM syntax</td></tr></table><h3 id="Variable-Selection"><a class="docs-heading-anchor" href="#Variable-Selection">Variable Selection</a><a id="Variable-Selection-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Selection" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Command</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins, dydx(x1 x2)</code></td><td style="text-align: right"><code>population_margins(model, data; type=:effects, vars=[:x1, :x2])</code></td><td style="text-align: right">Specific variables only</td></tr><tr><td style="text-align: right"><code>margins, dydx(_continuous)</code></td><td style="text-align: right"><code>population_margins(model, data; type=:effects)</code></td><td style="text-align: right">All continuous variables (automatic)</td></tr><tr><td style="text-align: right"><code>margins, eyex(x1)</code></td><td style="text-align: right"><code>population_margins(model, data; type=:effects, vars=[:x1], measure=:elasticity)</code></td><td style="text-align: right">Elasticities</td></tr></table><h2 id="Grouping-and-Stratification"><a class="docs-heading-anchor" href="#Grouping-and-Stratification">Grouping and Stratification</a><a id="Grouping-and-Stratification-1"></a><a class="docs-heading-anchor-permalink" href="#Grouping-and-Stratification" title="Permalink"></a></h2><h3 id="Basic-Grouping"><a class="docs-heading-anchor" href="#Basic-Grouping">Basic Grouping</a><a id="Basic-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Grouping" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Command</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins education</code></td><td style="text-align: right"><code>population_margins(model, data; groups=:education)</code></td><td style="text-align: right">Group predictions</td></tr><tr><td style="text-align: right"><code>margins education, dydx(*)</code></td><td style="text-align: right"><code>population_margins(model, data; type=:effects, groups=:education)</code></td><td style="text-align: right">Group effects</td></tr><tr><td style="text-align: right"><code>margins, over(education)</code></td><td style="text-align: right"><code>population_margins(model, data; groups=:education)</code></td><td style="text-align: right">Alternative syntax</td></tr><tr><td style="text-align: right"><code>margins education gender</code></td><td style="text-align: right"><code>population_margins(model, data; groups=[:education, :gender])</code></td><td style="text-align: right">Cross-tabulation</td></tr><tr><td style="text-align: right"><code>margins education#gender</code></td><td style="text-align: right"><code>population_margins(model, data; groups=[:education, :gender])</code></td><td style="text-align: right">Interaction syntax</td></tr></table><h3 id="Nested-Analysis"><a class="docs-heading-anchor" href="#Nested-Analysis">Nested Analysis</a><a id="Nested-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Nested-Analysis" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Command</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>by region: margins education</code></td><td style="text-align: right"><code>population_margins(model, data; groups=:region =&gt; :education)</code></td><td style="text-align: right">Nested grouping</td></tr><tr><td style="text-align: right"><code>margins education, over(region)</code></td><td style="text-align: right"><code>population_margins(model, data; groups=[:education, :region])</code></td><td style="text-align: right">Cross-tabulation alternative</td></tr></table><h2 id="Scenario-Analysis-(at()-Specification)"><a class="docs-heading-anchor" href="#Scenario-Analysis-(at()-Specification)">Scenario Analysis (<code>at()</code> Specification)</a><a id="Scenario-Analysis-(at()-Specification)-1"></a><a class="docs-heading-anchor-permalink" href="#Scenario-Analysis-(at()-Specification)" title="Permalink"></a></h2><h3 id="Basic-Scenarios"><a class="docs-heading-anchor" href="#Basic-Scenarios">Basic Scenarios</a><a id="Basic-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Scenarios" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Command</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins, at(x=0)</code></td><td style="text-align: right"><code>profile_margins(model, data, cartesian_grid(x=[0]); type=:predictions)</code></td><td style="text-align: right">Single scenario</td></tr><tr><td style="text-align: right"><code>margins, at(x=(0 1 2))</code></td><td style="text-align: right"><code>profile_margins(model, data, cartesian_grid(x=[0, 1, 2]); type=:predictions)</code></td><td style="text-align: right">Multiple values</td></tr><tr><td style="text-align: right"><code>margins, at(x=0 y=1)</code></td><td style="text-align: right"><code>profile_margins(model, data, cartesian_grid(x=[0], y=[1]); type=:predictions)</code></td><td style="text-align: right">Multiple variables</td></tr></table><h3 id="Population-Level-Counterfactuals"><a class="docs-heading-anchor" href="#Population-Level-Counterfactuals">Population-Level Counterfactuals</a><a id="Population-Level-Counterfactuals-1"></a><a class="docs-heading-anchor-permalink" href="#Population-Level-Counterfactuals" title="Permalink"></a></h3><p><strong>Key Difference</strong>: Stata&#39;s <code>at()</code> creates evaluation points, while Margins.jl&#39;s <code>scenarios</code> creates population counterfactuals.</p><table><tr><th style="text-align: right">Stata Approach</th><th style="text-align: right">Margins.jl Population Approach</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins, at(treatment=(0 1))</code></td><td style="text-align: right"><code>population_margins(model, data; scenarios=(treatment=[0, 1]))</code></td><td style="text-align: right">Everyone untreated vs everyone treated</td></tr><tr><td style="text-align: right"><code>margins education, at(policy=(0 1))</code></td><td style="text-align: right"><code>population_margins(model, data; groups=:education, scenarios=(policy=[0, 1]))</code></td><td style="text-align: right">Policy effects by education</td></tr></table><h3 id="Profile-vs-Population-Interpretation"><a class="docs-heading-anchor" href="#Profile-vs-Population-Interpretation">Profile vs Population Interpretation</a><a id="Profile-vs-Population-Interpretation-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-vs-Population-Interpretation" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Stata: margins, at(treatment=(0 1))
# → Effects at two evaluation points

# Margins.jl Profile Equivalent
profile_results = profile_margins(model, data, 
    cartesian_grid(treatment=[0, 1]);
    type=:effects)

# Margins.jl Population Alternative (often more relevant)  
population_results = population_margins(model, data;
    scenarios=(treatment=[0, 1]),
    type=:effects)</code></pre><h3 id="Skip-Rule:-dydx(x)-with-over(x)-(and-scenarios)"><a class="docs-heading-anchor" href="#Skip-Rule:-dydx(x)-with-over(x)-(and-scenarios)">Skip Rule: <code>dydx(x)</code> with <code>over(x)</code> (and scenarios)</a><a id="Skip-Rule:-dydx(x)-with-over(x)-(and-scenarios)-1"></a><a class="docs-heading-anchor-permalink" href="#Skip-Rule:-dydx(x)-with-over(x)-(and-scenarios)" title="Permalink"></a></h3><p>Unlike Stata, <code>population_margins</code> intentionally skips computing the effect of a variable when that same variable appears in <code>groups</code> (Stata <code>over()</code>) or in <code>scenarios</code> (Stata <code>at()</code>). This avoids the contradiction of “compute the effect of x while holding x fixed” or “using x both as an effect variable and a grouping key.”</p><p>Recommended translations:</p><pre><code class="language-julia hljs"># 1) Stata: margins, dydx(x) over(x)
# → Profile-style alternative: evaluate derivatives at specific x values
mem_like = profile_margins(model, data,
    cartesian_grid(x=[-2.0, 0.0, 2.0]);
    type=:effects,
    vars=[:x])

# 2) Population stratification by x without contradiction:
#    Create a derived bin variable and group by it, not by :x directly
df.x_bin = cut(df.x, 4)  # quartiles via user code; or use groups=(:x, 4)
by_xbins = population_margins(model, df;
    type=:effects,
    vars=[:x],
    groups=:x_bin)  # allowed since groups variable ≠ :x

# 3) Effects of other variables within x strata (population approach)
effects_in_xbins = population_margins(model, data;
    type=:effects,
    vars=[:z, :w],
    groups=(:x, 4))

# 4) Counterfactual predictions as x changes (not effects of x)
preds_under_x = population_margins(model, data;
    type=:predictions,
    scenarios=(x=[-2.0, 0.0, 2.0]))</code></pre><p>See also: “Skip Rule” note in the Population Grouping docs for rationale and guidance.</p><h4 id="Short-example:-grouping-by-x_bin-to-compute-dydx(x)-across-strata"><a class="docs-heading-anchor" href="#Short-example:-grouping-by-x_bin-to-compute-dydx(x)-across-strata">Short example: grouping by <code>x_bin</code> to compute <code>dydx(x)</code> across strata</a><a id="Short-example:-grouping-by-x_bin-to-compute-dydx(x)-across-strata-1"></a><a class="docs-heading-anchor-permalink" href="#Short-example:-grouping-by-x_bin-to-compute-dydx(x)-across-strata" title="Permalink"></a></h4><pre><code class="language-julia hljs">using Random
using DataFrames, CategoricalArrays
using Statistics  # for quantile
using GLM
using Margins

Random.seed!(42)
n = 500
df = DataFrame(
    y = rand(Bool, n),
    x = randn(n),
    z = randn(n)
)

# Fit a simple model
m = glm(@formula(y ~ x + z), df, Binomial(), LogitLink())

# Create quartile bins for x as a separate column &quot;x_bin&quot;
edges = quantile(df.x, 0:0.25:1.0)
labels = [&quot;Q1&quot;, &quot;Q2&quot;, &quot;Q3&quot;, &quot;Q4&quot;]
df.x_bin = cut(df.x, edges; labels=labels, extend=true)

# Now compute population AME of x within x_bin strata (no contradiction)
res = population_margins(m, df;
    type=:effects,
    vars=[:x],
    groups=:x_bin)

DataFrame(res)  # Shows dydx(x) by Q1..Q4</code></pre><h2 id="Combined-Grouping-and-Scenarios"><a class="docs-heading-anchor" href="#Combined-Grouping-and-Scenarios">Combined Grouping and Scenarios</a><a id="Combined-Grouping-and-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Combined-Grouping-and-Scenarios" title="Permalink"></a></h2><h3 id="Complex-Analysis-Patterns"><a class="docs-heading-anchor" href="#Complex-Analysis-Patterns">Complex Analysis Patterns</a><a id="Complex-Analysis-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Complex-Analysis-Patterns" title="Permalink"></a></h3><table><tr><th style="text-align: right">Stata Pattern</th><th style="text-align: right">Margins.jl Equivalent</th><th style="text-align: right">Notes</th></tr><tr><td style="text-align: right"><code>margins education, at(treatment=(0 1))</code></td><td style="text-align: right"><code>population_margins(model, data; groups=:education, scenarios=(treatment=[0, 1]))</code></td><td style="text-align: right">Group × scenario analysis</td></tr><tr><td style="text-align: right">Multiple <code>margins</code> commands</td><td style="text-align: right">Single comprehensive call</td><td style="text-align: right">More efficient in Julia</td></tr></table><h2 id="Advanced-Patterns-Beyond-Stata"><a class="docs-heading-anchor" href="#Advanced-Patterns-Beyond-Stata">Advanced Patterns Beyond Stata</a><a id="Advanced-Patterns-Beyond-Stata-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Patterns-Beyond-Stata" title="Permalink"></a></h2><p>Margins.jl extends far beyond Stata&#39;s capabilities with features unavailable in Stata:</p><h3 id="Continuous-Variable-Binning"><a class="docs-heading-anchor" href="#Continuous-Variable-Binning">Continuous Variable Binning</a><a id="Continuous-Variable-Binning-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-Variable-Binning" title="Permalink"></a></h3><pre><code class="language-stata hljs">* Stata approach (manual and cumbersome):
gen income_q = .
_pctile income, nq(4)
replace income_q = 1 if income &lt;= r(r1)
replace income_q = 2 if income &gt; r(r1) &amp; income &lt;= r(r2)
replace income_q = 3 if income &gt; r(r2) &amp; income &lt;= r(r3)
replace income_q = 4 if income &gt; r(r3)
margins income_q</code></pre><pre><code class="language-julia hljs"># Julia approach (automatic):
population_margins(model, data; groups=(:income, 4))  # Automatic Q1-Q4 quartiles</code></pre><h3 id="Custom-Policy-Thresholds"><a class="docs-heading-anchor" href="#Custom-Policy-Thresholds">Custom Policy Thresholds</a><a id="Custom-Policy-Thresholds-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Policy-Thresholds" title="Permalink"></a></h3><pre><code class="language-stata hljs">* Stata approach:
gen income_bracket = .
replace income_bracket = 1 if income &lt; 25000
replace income_bracket = 2 if income &gt;= 25000 &amp; income &lt; 50000
replace income_bracket = 3 if income &gt;= 50000 &amp; income &lt; 75000
replace income_bracket = 4 if income &gt;= 75000
margins income_bracket</code></pre><pre><code class="language-julia hljs"># Julia approach:
population_margins(model, data; groups=(:income, [25000, 50000, 75000]))</code></pre><h3 id="Hierarchical-Grouping"><a class="docs-heading-anchor" href="#Hierarchical-Grouping">Hierarchical Grouping</a><a id="Hierarchical-Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Hierarchical-Grouping" title="Permalink"></a></h3><pre><code class="language-stata hljs">* Stata approach (requires multiple commands or complex by groups):
by region: margins education
* No native support for deep nesting</code></pre><pre><code class="language-julia hljs"># Julia approach (native hierarchical support):
population_margins(model, data; groups=:region =&gt; :education)
population_margins(model, data; groups=:country =&gt; (:region =&gt; :education))  # Deep nesting</code></pre><h3 id="Multi-Variable-Scenarios"><a class="docs-heading-anchor" href="#Multi-Variable-Scenarios">Multi-Variable Scenarios</a><a id="Multi-Variable-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Variable-Scenarios" title="Permalink"></a></h3><pre><code class="language-stata hljs">* Stata approach (requires multiple separate commands):
margins, at(treatment=0 policy=0)
margins, at(treatment=0 policy=1) 
margins, at(treatment=1 policy=0)
margins, at(treatment=1 policy=1)</code></pre><pre><code class="language-julia hljs"># Julia approach (automatic Cartesian product):
population_margins(model, data; scenarios=(treatment=[0, 1], policy=[0, 1]))</code></pre><p>Note: <code>scenarios</code> in Julia are population‑level counterfactuals (everyone receives each setting in turn). For Stata’s point‑evaluation semantics of <code>at()</code>, use <code>profile_margins(model, data, reference_grid)</code> with a grid builder (e.g., <code>means_grid</code>, <code>cartesian_grid</code>) or an explicit DataFrame.</p><h2 id="Complete-Workflow-Examples"><a class="docs-heading-anchor" href="#Complete-Workflow-Examples">Complete Workflow Examples</a><a id="Complete-Workflow-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-Workflow-Examples" title="Permalink"></a></h2><h3 id="Example-1:-Education-Policy-Analysis"><a class="docs-heading-anchor" href="#Example-1:-Education-Policy-Analysis">Example 1: Education Policy Analysis</a><a id="Example-1:-Education-Policy-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Education-Policy-Analysis" title="Permalink"></a></h3><h4 id="Stata-Workflow"><a class="docs-heading-anchor" href="#Stata-Workflow">Stata Workflow</a><a id="Stata-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Stata-Workflow" title="Permalink"></a></h4><pre><code class="language-stata hljs">* Fit model
logit outcome education income female urban policy_treatment

* Basic effects
margins, dydx(*)

* Effects by education
margins education, dydx(income)

* Policy scenarios (multiple commands required)
margins education, at(policy_treatment=0)
margins education, at(policy_treatment=1)

* Manual difference calculation needed for treatment effects</code></pre><h4 id="Julia-Workflow"><a class="docs-heading-anchor" href="#Julia-Workflow">Julia Workflow</a><a id="Julia-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Workflow" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Fit model  
model = glm(@formula(outcome ~ education + income + female + urban + policy_treatment),
            data, Binomial(), LogitLink())

# Basic effects
basic_effects = population_margins(model, data; type=:effects)

# Effects by education
education_effects = population_margins(model, data; 
                                     type=:effects, 
                                     vars=[:income],
                                     groups=:education)

# Policy scenarios (automatic treatment effect calculation)
policy_analysis = population_margins(model, data;
                                   type=:effects,
                                   groups=:education,
                                   scenarios=(:policy_treatment =&gt; [0, 1]))

# All results readily available as DataFrames
DataFrame(policy_analysis)</code></pre><h3 id="Example-2:-Complex-Demographic-Analysis"><a class="docs-heading-anchor" href="#Example-2:-Complex-Demographic-Analysis">Example 2: Complex Demographic Analysis</a><a id="Example-2:-Complex-Demographic-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Complex-Demographic-Analysis" title="Permalink"></a></h3><h4 id="Stata-Approach-(Cumbersome)"><a class="docs-heading-anchor" href="#Stata-Approach-(Cumbersome)">Stata Approach (Cumbersome)</a><a id="Stata-Approach-(Cumbersome)-1"></a><a class="docs-heading-anchor-permalink" href="#Stata-Approach-(Cumbersome)" title="Permalink"></a></h4><pre><code class="language-stata hljs">* Multiple manual commands needed:
margins education, over(region)
margins gender, over(region)  
margins education#gender, over(region)

* Income quartiles require manual creation:
xtile income_q4 = income, nq(4)
margins education, over(income_q4)

* No native support for hierarchical analysis</code></pre><h4 id="Julia-Approach-(Comprehensive)"><a class="docs-heading-anchor" href="#Julia-Approach-(Comprehensive)">Julia Approach (Comprehensive)</a><a id="Julia-Approach-(Comprehensive)-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Approach-(Comprehensive)" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Single comprehensive analysis
comprehensive_results = population_margins(model, data;
    type=:effects,
    groups=:region =&gt; [:education, :gender, (:income, 4)]
)

# Results: Region × (Education + Gender + Income-Quartiles) automatically computed
# Professional Q1-Q4 labeling included
DataFrame(comprehensive_results)</code></pre><h2 id="Performance-Comparisons"><a class="docs-heading-anchor" href="#Performance-Comparisons">Performance Comparisons</a><a id="Performance-Comparisons-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Comparisons" title="Permalink"></a></h2><h3 id="Computational-Advantages"><a class="docs-heading-anchor" href="#Computational-Advantages">Computational Advantages</a><a id="Computational-Advantages-1"></a><a class="docs-heading-anchor-permalink" href="#Computational-Advantages" title="Permalink"></a></h3><table><tr><th style="text-align: right">Aspect</th><th style="text-align: right">Stata</th><th style="text-align: right">Margins.jl</th></tr><tr><td style="text-align: right"><strong>Complex grouping</strong></td><td style="text-align: right">Multiple manual commands</td><td style="text-align: right">Single comprehensive call</td></tr><tr><td style="text-align: right"><strong>Scenario analysis</strong></td><td style="text-align: right">Manual looping/multiple commands</td><td style="text-align: right">Automatic Cartesian products</td></tr><tr><td style="text-align: right"><strong>Large datasets</strong></td><td style="text-align: right">Memory limitations</td><td style="text-align: right">Efficient O(n) scaling</td></tr><tr><td style="text-align: right"><strong>Custom thresholds</strong></td><td style="text-align: right">Manual variable creation</td><td style="text-align: right">Automatic binning with labels</td></tr><tr><td style="text-align: right"><strong>Hierarchical analysis</strong></td><td style="text-align: right">Limited native support</td><td style="text-align: right">Unlimited nesting depth</td></tr></table><h3 id="Stata-Command-Count-Reduction"><a class="docs-heading-anchor" href="#Stata-Command-Count-Reduction">Stata Command Count Reduction</a><a id="Stata-Command-Count-Reduction-1"></a><a class="docs-heading-anchor-permalink" href="#Stata-Command-Count-Reduction" title="Permalink"></a></h3><pre><code class="language-julia hljs"># This single Julia command:
result = population_margins(model, data;
    groups=:region =&gt; [:education, (:income, 4)],
    scenarios=(treatment=[0, 1], policy=[&quot;old&quot;, &quot;new&quot;])
)

# Replaces ~30 individual Stata margins commands:
# 4 regions × 3 education × 4 income × 2 treatment × 2 policy = 192 combinations
# Plus manual variable creation, looping, and results compilation</code></pre><h2 id="Migration-Best-Practices"><a class="docs-heading-anchor" href="#Migration-Best-Practices">Migration Best Practices</a><a id="Migration-Best-Practices-1"></a><a class="docs-heading-anchor-permalink" href="#Migration-Best-Practices" title="Permalink"></a></h2><h3 id="Common-Translation-Patterns"><a class="docs-heading-anchor" href="#Common-Translation-Patterns">Common Translation Patterns</a><a id="Common-Translation-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Translation-Patterns" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Pattern 1: Simple margins → population_margins
# margins → population_margins(model, data; type=:predictions)

# Pattern 2: Effects by groups → groups parameter  
# margins education, dydx(*) → population_margins(model, data; type=:effects, groups=:education)

# Pattern 3: Multiple at() values → scenarios or profile grids
# margins, at(x=(0 1 2)) → profile_margins(model, data, cartesian_grid(x=[0, 1, 2]))
# OR population_margins(model, data; scenarios=(x=[0, 1, 2]))  # for counterfactuals

# Pattern 4: Complex manual analysis → comprehensive single call
# Multiple Stata commands → single population_margins with groups + scenarios</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../advanced/">« Advanced Features</a><a class="docs-footer-nextpage" href="../comparison/">Package Comparison »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Friday 24 October 2025 22:15">Friday 24 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
